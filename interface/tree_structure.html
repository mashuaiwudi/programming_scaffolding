<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Practice Page</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        body {
            font-family: 'Arial', sans-serif; /* A clean, readable font */
            background-color: #f4f6f8; /* A soft gray background */
            color: #333; /* Darker text for better readability */
            margin: 0;
            padding: 0;
            line-height: 1.6; /* Improve line spacing */
        }

        h2 {
            color: #2c3e50; /* A dark blue shade for headers */
        }






        .left, .center, .right {
            flex: 1; /* Each section takes equal width */
            margin: 0 10px;
            padding: 10px;
            overflow-y: auto; /* Adds scroll to each column if content is too long */
        }


        .left {
    flex: 0 0 25%; /* 定义宽度占比 */
    padding: 10px; /* 提供内边距 */
    overflow-y: auto; /* 超出垂直范围时启用滚动 */
    max-width: 100%; /* 限制最大宽度，避免溢出 */
    box-sizing: border-box; /* 边框和内边距包含在宽度内 */
}

.left pre {
    white-space: pre-wrap; /* 允许自动换行和保持空格 */
    word-wrap: break-word; /* 确保长单词可以断行 */
    overflow-wrap: break-word; /* 同 word-wrap */
    max-width: 100%; /* 防止宽度超出父容器 */
}

        .center {
            flex: 0 0 25%; /* center column width */
            display: flex;
            flex-direction: column;
        }

        .right {
            flex: 0 0 50%; /* right column width */
        }





        .container {
            display: flex;
            height: 100vh; /* Use the full height of the viewport */
            padding: 10px;
        }


        .container {
            position: relative; /* 确保父容器是相对定位 */
            display: flex;
            height: 100vh;
            width: 100%; /* Ensure the container spans the entire width */
        }




        .left, .center, .right {
            border: 1px solid #ccc; /* Subtle border for each column */
            padding: 20px;
            overflow: auto; /* Scroll bars as necessary */
        }

        .left {
            flex: 2; /* Give more space to the left column */
            background-color: #ffffff; /* White background for contrast */
        }

        .center {
            flex: 3; /* Center column gets the most space */
            background-color: #eef2f5; /* Lighter grey to differentiate from left */
            position: relative; /* 使子元素的绝对定位相对于此容器 */
        }

        .right {
            flex: 3; /* Same as left */
            background-color: #ffffff; /* Maintain consistency with left column */
        }






        .button-bridge {
    position: relative; /* 相对定位 */
    top: 50%; /* 垂直居中 */
    transform: translateY(-50%); /* 确保垂直居中的精确对齐 */
    display: flex; /* 使用flex布局垂直堆叠按钮 */
    flex-direction: column; /* 设置flex方向为列 */
    align-items: center; /* 垂直居中对齐内容 */
    justify-content: center; /* 水平居中对齐内容 */
    height: 100%; /* 确保高度为100% */
    z-index: 1000; /* 确保按钮桥在最前面 */
}


.button-bridge img {
    width: 25px; /* 设置按钮大小 */
    height: 25px;
    cursor: pointer; /* 鼠标悬浮时显示指针 */
    opacity: 0.8; /* 初始透明度设置 */
    transition: opacity 0.3s; /* 过渡动画 */
}

.button-bridge img:hover {
    opacity: 1; /* 鼠标悬浮时完全不透明 */
}









        textarea#code {
            width: 100%; /* Make these elements take up full column width */
            border-radius: 4px; /* Rounded corners */
            border: 1px solid #bdc3c7; /* A light grey border */
            padding: 10px; /* Padding for better text visibility */
            background-color: #fff; /* White background for clarity */
            box-sizing: border-box; /* Include padding and border in width */
            resize: none; /* Disable resizing for textarea */
            min-height: 500px; /* Set a fixed height for the textarea */
        }




        select#language-selector {
            border-radius: 4px; /* Rounded corners */
            border: 1px solid #bdc3c7; /* A light grey border */
            padding: 5px; /* Padding for better text visibility */
            background-color: #fff; /* White background for clarity */
            box-sizing: border-box; /* Include padding and border in width */
            resize: none; /* Disable resizing for textarea */
        }



        select#language-selector {
            margin-bottom: 20px; /* Space below the selector */
        }

        button {
            background-color: #3498db; /* A vibrant blue */
            color: #ffffff; /* White text */
            border: none;
            padding: 10px 20px;
            border-radius: 5px; /* Rounded edges */
            cursor: pointer;
            transition: background 0.3s ease;
            margin-bottom: 10px; /* Space below the selector */
        }

        button:hover {
            background-color: #2980b9; /* A slightly darker blue on hover */
        }




        /* button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        } */

        
        #steps-container {
            height: 80%;
            overflow-y: auto;
            padding: 5px;
            box-sizing: border-box;
        }




        .step {
    position: relative;
    margin: 10px;
    padding: 5px 0px 0px 30px; /* 为按钮留出足够的padding */
    border: 2px solid #ccc;
    background-color: #ffffff;
    overflow: auto; /* 添加滚动条 */
    min-height: 200px;  /* 最小高度 */
    box-sizing: border-box;
    transition: height 0.3s ease, opacity 0.3s ease; /* 添加过渡效果 */
    display: flex; /* 使用 flex 布局 */
    align-items: stretch; /* 确保子元素填满整个容器的高度 */
}

.step::before {
    content: '';
    position: absolute;
    top: 10px;
    left: 10px;
    width: 10px;
    height: 10px;
    background-size: contain;
    background-repeat: no-repeat;
}


.substep {
    position: relative;
    margin-bottom: 10px; /* 子步骤之间的间隔 */
    border: 2px solid #ddd;
    padding: 5px 0px 0px 30px; /* 为按钮留出足够的padding  上 右 下 左*/
    width: 100%; /* 子步骤填满整个子步骤容器宽度 */
    min-height: 100px;  /* 最小高度 */
    overflow: auto; /* 添加滚动条 */
    transition: height 0.3s ease, opacity 0.3s ease; /* 添加过渡效果 */
    box-sizing: border-box; /* 确保 padding 和 border 包含在宽度内 */
    font-size: 12px; /* 设置字体大小为 11px */
}

.substep::before {
    content: '';
    position: absolute;
    top: 5px; /* 根据需要调整位置 */
    left: 5px; /* 根据需要调整位置 */
    width: 15px;
    height: 15px;
    background-size: contain;
    background-repeat: no-repeat;
}


.correct {
    background-color: #dff0d8; /* 绿色背景色 */
    border: 2px solid #3c763d;
}

.correct::before {
    content: '✓'; /* 可以替换为合适的图标或使用背景图 */
    color: #3c763d;
    font-size: 14px; /* 根据需要调整 */
}

.missing {
    background-color: #ffffff;
    border: 2px solid #ddd;
}


.incorrect {
    background-color: #f2dede; /* 红色背景色 */
    border: 2px solid #a94442;
}

.incorrect::before {
    content: '✗'; /* 可以替换为合适的图标或使用背景图 */
    color: #a94442;
    font-size: 14px; /* 根据需要调整 */
}



.systemgiven {
    background-color: #d9edf7; 
    border: 2px solid #31708f;
}

.systemgiven::before {
    content: 'AI'; /* 错号 */
    color: #31708f; /* 对号颜色 */
    font-size: 16px; /* 调整字体大小 */
}


.mapped {
    background-color: #dff0d8; 
    border: 2px solid #3c763d;
}

.mapped::before {
    content: '⇔'; /* 错号 */
    color: #3c763d; /* 对号颜色 */
    font-size: 16px; /* 调整字体大小 */
}



.unmapped {
    background-color: #fcf8e3;
    border: 2px solid #8a6d3b;
}

.unmapped::before {
    content: '⇎';
    color: #a94442;
    font-size: 14px;
}



        .sub-step {
            border: 1px dashed #666;
            margin: 5px 0; /* 仅纵向间隔 */
            padding: 5px;
            background-color: #fff;
            resize: vertical; /* 仅允许纵向调整大小 */
            overflow: auto; /* 内容超出时显示滚动条 */
            min-height: 50px; /* 设置最小高度 */
            width: calc(100% - 10px); /* 考虑内边距 */
            width: 80%; /* Sub-steps are 80% the width of their parent */
            margin-left: 20%; /* Indent sub-steps for visual hierarchy */
        }
       
        .info {
            background-color: #d9edf7; /* 红色背景色 */
            color: #31708f; /* 白色文本颜色，用于提高可读性 */
        }




        .can-be-divided {
            border-style: dashed;
            border-width: 5px; /* Adjust the thickness of the dashes */
        }


        .user-added {
            border-width: 5px; /* Adjust the thickness of the dashes */
        }


        /* .can-be-divided::after {
            content: '<>';
            font-size: 24px;
            position:absolute;
            right: 30px;
        } */
        .magnifier {
            position: absolute;
            left: 5px; /* 定位到块的左侧 */
            bottom: 5px; /* 定位到块的底部 */
            cursor: pointer;
            width: 25px; /* 或适合你的图标尺寸 */
            height: 25px; /* 或适合你的图标尺寸 */
        }

        #hint-area {
            padding: 10px;
            border-top: 1px solid #ccc;
            margin-top: 20px;
            background-color: #f9f9f9;
            color: #333;
            width: 300px;
            white-space: pre-wrap;
            overflow-wrap: break-word;
        }


        .split-button, .remove-button {
            cursor: pointer;
            width: 25px;
            height: 25px;
            border: none;
            padding: 0;
            background: none;
        }


        .split-button {
            position: absolute;
            bottom: 10px; /* 定位到块的底部 */
            right: 10px; /* 定位到块的右侧 */
        }






        .line-highlight {
            background-color: #ffff99c1; /* Light yellow, adjust color as needed */
        }


        .hint {
            display: none;
            position: relative;
            width: 100%;
            background-color: #e8f0fe; /* Light blue background */
            border-radius: 8px; /* Rounded corners */
            padding: 10px;
            box-sizing: border-box;
            font-family: Arial, sans-serif; /* Uniform font */
            font-size: 0.9em; /* Slightly smaller text */
            color: #333; /* Dark grey text color for readability */
            border: 1px solid #d3d3d3; /* Subtle border */
            margin-top: 10px; /* Spacing from content above */
        }

        .hint img {
            width: 20px;
            height: 20px;
        }

        .hint div {
            margin-left: 30px; /* Offset text to the right of the icon */
            line-height: 1.5; /* Improved line spacing */
        }


        .yes-button {
            background-color: #4CAF50; /* Red background for NO button */
            margin-bottom: 2px;
        }

        .yes-button:hover {
            background-color: #45a049; /* Darker red on hover for NO button */
        }
        .no-button {
            background-color: #3498db; /* Red background for NO button */
            margin-bottom: 2px;
        }

        .no-button:hover {
            background-color: #2980b9; /* Darker red on hover for NO button */
        }


        /*Loading 动画*/
        .hidden {
            display: none;
        }




        .loader {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* 半透明遮罩 */
            display: none; /* 默认不显示 */
            z-index: 10; /* 确保在上层 */
            color: white;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
        }
        



        .loader {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
            color: white;
            font-size: 1.5em;
        }

        .spinner {
            border: 8px solid rgba(255, 255, 255, 0.3); /* Light grey */
            border-top: 8px solid #fff; /* White */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }






        pre {
            font-family: 'Arial', sans-serif;
            white-space: pre-wrap; /* Ensures the text wraps */
            word-wrap: break-word; /* Ensures the text breaks properly at the end of lines */
            background-color: #f8f9fa; /* Light background color for contrast */
            padding: 15px; /* Padding for better readability */
            border-radius: 5px; /* Rounded corners for aesthetic appeal */
            border: 1px solid #ccc; /* Light border to define the area */
            font-size: 12px; /* Adjusting font size for better readability */
        }

        .CodeMirror {
            min-height: 500px; /* Set a fixed height for the CodeMirror editor */
        }
        /* Targeting directly the text container within CodeMirror */
        .CodeMirror {
            font-family: 'Arial', sans-serif !important; /* Using !important to ensure override */
            font-size: 12px; /* Adjusting font size for better readability */
            /* height: auto;  */
            /* Flexible height */
            border: 1px solid #ccc; /* Consistent styling with other elements */
            border-radius: 5px; /* Rounded corners */
        }

        /* You might also need to ensure the line numbers and the cursor also use the correct font */
        .CodeMirror-lines, .CodeMirror-cursor {
            font-family: 'Arial', sans-serif !important;
        }














/* 下面是一个左右添加substep的demo */

        .step-container {
            display: flex;
            align-items: stretch; /* 确保子步骤填充整个容器高度 */
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }

        .step_test {
            flex: 1;  /* 允许步骤占满所有可用空间 */
            padding: 10px;

            position: relative;
            margin: 10px;
            padding: 10px 10px 35px 35px; /* 为按钮留出足够的padding */
            border: 1px solid #ccc;
            background-color: #ffffff;
            overflow: hidden; /* 防止内容在动画时溢出 */
            min-height: 200px; /* 最小高度 */
            box-sizing: border-box;
            transition: height 0.3s ease, opacity 0.3s ease; /* 添加过渡效果 */
        }

        .substeps_test {
            flex: 0;  /* 初始时不占用空间 */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 隐藏不可见的内容 */
            transition: flex 0.3s ease; /* 平滑过渡效果 */
        }

        .substep_test {
            padding: 10px;
            background-color: lightgrey;
            border-bottom: 1px solid #aaa;
        }





        .substeps-container {
    width: calc(100% - 10px); /* 子步骤容器始终比父容器窄 */
    display: flex; /* 同样使用 flex 布局，但方向不同 */
    flex-direction: column; /* 子步骤纵向排列 */
    padding-left: 10px; /* 确保与父容器有间距 */
    box-sizing: border-box; /* 确保 padding 和 border 包含在宽度内 */
    overflow: auto; /* 允许滚动 */
    max-height: 100%; /* 避免子元素溢出 */

}






        .text-content {
            min-height: 20px;  /* 确保文本区域有基础高度 */
            max-height: 35px; /* 设置最大高度 */
            cursor: text;
            width: 99%; /* 设置宽度为父元素的一半 */
            /* width: calc(100% - 40px); */
            overflow: hidden;
            overflow-y: auto; /* 当内容超过高度时自动显示垂直滚动条 */
            margin-bottom: 5px; /* 调整底部外边距，减少间距 */
            border: 1px solid #aaa;
            font-family: Arial, Helvetica, sans-serif;
            background-color: transparent;
        }




        .add-substep-button {
            position: absolute;
            right: 100px; /* 定位到块的左侧 */

            cursor: pointer;
            width: 25px; /* 或适合你的图标尺寸 */
            height: 25px; /* 或适合你的图标尺寸 */
        }




        .shuai_layout{
            display: flex;
            flex-wrap: wrap;
            justify-content: left;
        }


        .ma_layout{
            display: flex;
            flex-wrap: wrap;
            justify-content:space-between;
        }


        .legend-container {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 20px; /* Space between legend and steps container */
            border: 2px dashed #aaa;
            padding: 10px 10px 10px 10px;

        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 20px; /* Space between legend items */
            font-size: 12px;
        }

        .legend-box {
            min-width: 20px;
            min-height: 20px;
            margin-right: 5px; /* Space between box and text */
        }


        .correct_legend {
            background-color: #dff0d8; 
            border: 2px solid #3c763d;
            position: relative;
        }

        .correct_legend::before {
            content: '✓'; /* 对号 */
            color: #3c763d; /* 对号颜色 */
            font-size: 16px; /* 调整字体大小 */
            position: absolute;
        }

        .missing_legend {
            background-color: #ffffff; 
            border: 2px solid #aaa;
            position: relative;
        }

        .incorrect_legend {
            background-color: #f2dede; /* 红色背景 */
            border: 2px solid #a94442;
            position: relative;
        }

        .incorrect_legend::before {
            content: '✗'; /* 错号 */
            color: #a94442; /* 错号颜色 */
            font-size: 16px; /* 调整字体大小 */
            position: absolute;
        }

        .systemgiven_legend {
            background-color: #d9edf7; /* 红色背景 */
            border: 2px solid #31708f;
            position: relative;
        }

        .systemgiven_legend::before {
            content: 'AI'; /* 错号 */
            color: #31708f; /* 错号颜色 */
            font-size: 16px; /* 调整字体大小 */
            position: absolute;
        }





        .unmapped_legend {
            background-color: #fcf8e3; /* 红色背景 */
            border: 2px solid #8a6d3b;
            position: relative;
        }



        .unmapped_legend::before {
            content: '⇎'; /* 错号 */
            color: #a94442; /* 错号颜色 */
            font-size: 16px; /* 调整字体大小 */
            position: absolute;
        }


        .mapped_legend {
            background-color: #dff0d8; 
            border: 2px solid #3c763d;
            position: relative;
        }



        .mapped_legend::before {
            content: '⇔'; /* 错号 */
            color: #3c763d; /* 对号颜色 */
            font-size: 16px; /* 调整字体大小 */
            position: absolute;
        }





        .can-be-divided_legend {
            border-style: dashed;
            border-width: 5px; /* Adjust the thickness of the dashes */
            border: 2px dashed #aaa;
        }



        .step_highlight {
            border: 2px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
            padding: 10px;
            transition: box-shadow 0.3s ease, transform 0.3s ease;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
            border-color: yellow;
        }


        .error-text {
            background-color: #f2dede; /* 红色背景色 */
            color: #a94442; /* 白色文本颜色，用于提高可读性 */
            padding: 10px; /* 可根据需要调整内边距 */
            border-radius: 5px; /* 可根据需要调整边框半径，使其更圆角 */
        }
        .correct-text {
            background-color: #dff0d8; /* 红色背景色 */
            color: #3c763d; /* 白色文本颜色，用于提高可读性 */
            padding: 10px; /* 可根据需要调整内边距 */
            border-radius: 5px; /* 可根据需要调整边框半径，使其更圆角 */
        }

        .warning-text {
            background-color: #fcf8e3; /* 红色背景色 */
            color: #8a6d3b; /* 白色文本颜色，用于提高可读性 */
            padding: 10px; /* 可根据需要调整内边距 */
            border-radius: 5px; /* 可根据需要调整边框半径，使其更圆角 */
        }




        .toggle-icon {
    font-size: 12px;
    cursor: pointer;
    margin-bottom: 1px;
    display: inline-block;
    margin-right: 10px;
    vertical-align: middle;
}



        /* 去掉默认的边框样式 */
        .end-line {
            width: 100%;
            border: none;
            height: 1px;
            background-color: black;
            margin-bottom: 10px;
        }
        /* 文本样式 */
        .end-text {
            background-color: white;
            padding: 0 10px;
        }

        .error-gutter {
        width: 20px; /* 调整 gutter 宽度 */
    }

    .error-marker {
        position: absolute;
        left: 0;
        top: 0;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: red;
        margin-left: -25px;
        cursor: pointer;
    }

    table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 12px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }









        #problem-list-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100%;
            background-color: white;
            border-right: 1px solid #ccc;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto;
            transition: transform 0.3s ease;
            transform: translateX(-100%);
        }
        #problem-list-container.show {
            display: block;
            transform: translateX(0);
        }
        #problem-list {
            list-style-type: none;
            padding: 20px;
        }
        #problem-list li {
            margin: 10px 0;
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        #problem-list li.selected {
            background-color: #f0f0f0; /* Selected background color */
        }
        #problem-list li:hover {
            background-color: #f0f0f0;
        }
        #show-problem-list {
            margin: 0px;
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 5px 5px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            color: #333;
            font-size: 14px;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.2s;
        }
        #show-problem-list:hover {
            background-color: #e9e9e9;
        }
        #show-problem-list img {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
        #content {
            margin-left: 40px;
        }



    </style>
    
</head>
<body>




    <div class="container">
        <div class="left">
            <h3 id="question_name">Question: Roman to Integer</h3>
            <button id="show-problem-list">
                <img src="list.png" alt="icon">
                Problem List
            </button>
            <div id="problem-list-container">
                <ul id="problem-list"></ul>
            </div>







            <pre id="problem-description">
Roman numerals are represented by seven different symbols: I, V, X, L, C, D, and M.

Symbol       Value
I             1
V             5
X             10
L             50
C             100
D             500
M             1000

For example, 2 is written as II in Roman numeral, just two ones added together. 12 is written as XII, which is simply X + II. The number 27 is written as XXVII, which is XX + V + II.

Roman numerals are usually written largest to smallest from left to right. However, the numeral for four is not IIII. Instead, the number four is written as IV. 
Because the one is before the five we subtract it making four. The same principle applies to the number nine, which is written as IX. There are six instances where subtraction is used:

I can be placed before V (5) and X (10) to make 4 and 9.
X can be placed before L (50) and C (100) to make 40 and 90.
C can be placed before D (500) and M (1000) to make 400 and 900.
Given a roman numeral, convert it to an integer.
            </pre>

        </div>
        <div class="center">
            <h3>Editor</h3>
            <div class="shuai_layout">
                <p style="font-size: 14px;">Choose Your Language</p>
                <select style="margin-left: 7px; margin-top: 11px; font-size: 12px;" id="language-selector">
                    <option value="python">Python</option>
                    <option value="javascript">JavaScript</option>
                    <option value="java">Java</option>
                    <option value="c++">C++</option>
                    <!-- Add more language options -->
                </select>
                <!-- <img src="run.png" style="margin-left: 30px; width: 35px; height: 35px; cursor: pointer;" id="openedit-btn" onclick="runPython()"> -->
            </div>
            
            <!-- <textarea id="code">
def romanToInt(s):
    """
    :type s: str
    :rtype: int
    """
    dict1={'I':1,'V':5,'X':10,'L':50,'C':100,'D':500,'M':1000 }
    val=0

    for i in range(len(s)):
        val=val+dict1[s[i]]
        if i!=0:
            if dict1[s[i]]>dict1[s[i-1]]:
                val=val-2*(dict1[s[i-1]])
    return val
    # Compare the current numeral value with the next one to identify if subtraction is needed.
            </textarea> -->


            <textarea id="code">
def romanToInt(s):

    dict1={'I':1,'V':5,'X':10,'L':50,'C':100,'D':500,'M':1000 }
    val=0

            </textarea>
            <button onclick="runTestCases()">Run</button>


            <pre id="output">
            </pre>
                <table>
                    <thead>
                        <tr>
                            <th>Test Case</th>
                            <th>Input</th>
                            <th>Expected Output</th>
                            <th>Your Output</th>
                            <th>Correctness</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Case 1</td>
                            <td id="input-1"></td>
                            <td id="target-output-1"></td>
                            <td id="your-output-1"></td>
                            <td id="correctness-1"></td>
                        </tr>
                        <tr>
                            <td>Case 2</td>
                            <td id="input-2"></td>
                            <td id="target-output-2"></td>
                            <td id="your-output-2"></td>
                            <td id="correctness-2"></td>
                        </tr>
                        <tr>
                            <td>Case 3</td>
                            <td id="input-3"></td>
                            <td id="target-output-3"></td>
                            <td id="your-output-3"></td>
                            <td id="correctness-3"></td>
                        </tr>
                    </tbody>
                </table>

            


        </div>
        <div class="button-bridge">
            <img src="right.png" alt="Editor to box" id="btnUp" onclick="generateJson_fromEditor()" title="Generate step tree based on your code">
            <br>
            <img src="check.png" alt="Check" onclick="checkRelevance()" title="Check the mapping between your code and your step tree">
            <br>
            <img src="left.png" alt="Box to editor" id="ready-to-code-btn" title="Insert your step tree as code comments to the editor">            
        </div>
        <div class="right" style="position: relative;">
            <div id="loading" class="loader hidden">
                <div class="spinner"></div>
            </div>
            
            <div class="ma_layout">
            <h3>Steps</h3>
            <img src="edit.png" style="width: 25px; height: 25px; cursor: pointer;" id="openedit-btn" onclick="openEditMode()" title="Edit your step tree">
            <img src="save.png" style="width: 25px; height: 25px; cursor: pointer; display: none;" id="verify-btn" onclick="generateJson_fromBlock()" title="Save your edited step tree and verify the correctness">
            </div>

            <div class="shuai_layout">


                <div class="legend-container">

                    <div class="legend-item">
                        <div class="legend-box correct_legend"></div>
                        <span>Correct</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box incorrect_legend"></div>
                        <span>Incorrect</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box missing_legend"></div>
                        <span>Missing</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box can-be-divided_legend"></div>
                        <span>Can be divided</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box systemgiven_legend"></div>
                        <span>System generated</span>
                    </div>
                    
                    <div class="legend-item">
                        <div class="legend-box mapped_legend"></div>
                        <span>Implemented</span>
                    </div>

                    <div class="legend-item">
                        <div class="legend-box unmapped_legend"></div>
                        <span>To be coded</span>
                    </div>
                </div>
            </div>

            <div id="steps-container"></div>


            <hr class="end-line">
      

        </div>
        
    </div>

    


    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.js"></script>
    <script src="jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.21.3/full/pyodide.js"></script>



<!-- 其他语言的模式文件 -->

    <script>

        // var common_prefix = "http://23.251.33.242:5000/";
        // var common_prefix = "http://localhost:5000/";
        var common_prefix = "http://107.151.253.13:5000/";

        var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
            lineNumbers: true,
            mode: 'text/plain',
            matchBrackets: true,
            theme: "default",
            gutters: ["CodeMirror-linenumbers", "error-gutter"],
            matchBrackets: true,
            indentUnit: 4,
            tabSize: 4,
            lineWrapping: true
        });







        // Function to add an error marker
        function addErrorMarker(lineNumber) {
            const marker = document.createElement("div");
            marker.classList.add("error-marker");
            marker.innerHTML = ""; // Use any error symbol you like

            editor.setGutterMarker(lineNumber - 1, "error-gutter", marker);
        }



        // Function to remove error marker
        function removeErrorMarker(lineNumber) {
            editor.setGutterMarker(lineNumber - 1, "error-gutter", null);
        }


//         // Example: Add error marker to line 3
//         addErrorMarker(3);
//         addErrorMarker(4);
//         addErrorMarker(5);



// // Example: Remove error markers from lines 3, 4, and 5

// removeErrorMarker(4); 





        var stepsData_test = {
            "steps": {
                "1": {
                    "description": "Create a mapping from Roman numeral characters to their integer values.",
                    "status": {
                        "correctness": "correct",
                        "can be further divided": "can"
                    },
                    "hint": "",
                    "lineNumber": "[3, 4, 5, 6, 7, 8, 9, 10, 11]",
                    "subSteps_display": 'yes',
                    "subSteps": {
                        "sub-step 1": {
                            "description": "Check if the current numeral is not the last one in the string.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can prevent out-of-bounds errors by ensuring the current index is less than the length of the string minus one."
                        },
                        "sub-step 2": {
                            "description": "Test if the numeral's value is less than the value of the next numeral.",
                            "status": {
                                "correctness": "incorrect",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can use the mapping you created earlier to compare the integer values of the current and next numeral characters."
                        },
                        "sub-step 3": {
                            "description": "Apply subtraction when needed and addition otherwise.",
                            "status": {
                                "correctness": "correct",
                                "can be further divided": "cannot"
                            },
                            "hint": "Remember to subtract the current value from the subsequent value if current is less; otherwise, just add the current value."
                        }
                    }
                },
                "2": {
                    "description": "Initialize a variable to hold the resulting integer value from the conversion.",
                    "status": {
                        "correctness": "correct",
                        "can be further divided": "cannot"
                    },
                    "hint": "",
                    "lineNumber": "13",
                    "subSteps_display": 'yes'
                },
                "3": {
                    "description": "Iterate over the characters of the input Roman numeral string.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "can"
                    },
                    "hint": "Think about how you can create a loop to check each character within the Roman numeral string.",
                    "lineNumber": "",
                    "subSteps_display": 'no',
                    "subSteps": {
                        "sub-step 1": {
                            "description": "Start a loop that will go through each character in the string.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can use a 'for' loop to iterate over each character in the string."
                        }
                    }
                },
                "4": {
                    "description": "Compare the current numeral value with the next one to identify if subtraction is needed.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "can"
                    },
                    "hint": "Figure out a way to look ahead to the next character in the string—if the current character's value is less than the next one, a subtraction operation is needed.",
                    "lineNumber": "",
                    "subSteps_display": 'no',
                    "subSteps": {
                        "sub-step 1": {
                            "description": "Check if the current numeral is not the last one in the string.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can prevent out-of-bounds errors by ensuring the current index is less than the length of the string minus one."
                        },
                        "sub-step 2": {
                            "description": "Test if the numeral's value is less than the value of the next numeral.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can use the mapping you created earlier to compare the integer values of the current and next numeral characters."
                        },
                        "sub-step 3": {
                            "description": "Apply subtraction when needed and addition otherwise.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "Remember to subtract the current value from the subsequent value if current is less; otherwise, just add the current value."
                        }
                    }
                },
                "5": {
                    "description": "Handle the last numeral in the string, if it has not been processed yet.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Make sure you've added the value of the last numeral after completing the loop, as there won't be a next numeral to compare it to.",
                    "lineNumber": "",
                    "subSteps_display": 'no'
                }
            }
        };

        var stepsData_test1 = {
            "steps": {
                "1": {
                    "description": "Create a mapping from Roman numeral characters to their integer values.",
                    "status": {
                        "correctness": "correct",
                        "can be further divided": "can"
                    },
                    "hint": "",
                    "lineNumber": "[3, 4, 5, 6, 7, 8, 9, 10, 11]",
                    "subSteps_display": 'yes',
                    "subSteps": {
                        "sub-step 1": {
                            "description": "Check if the current numeral is not the last one in the string.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can prevent out-of-bounds errors by ensuring the current index is less than the length of the string minus one."
                        },
                        "sub-step 2": {
                            "description": "Test if the numeral's value is less than the value of the next numeral.",
                            "status": {
                                "correctness": "incorrect",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can use the mapping you created earlier to compare the integer values of the current and next numeral characters."
                        },
                        "sub-step 3": {
                            "description": "Apply subtraction when needed and addition otherwise.",
                            "status": {
                                "correctness": "correct",
                                "can be further divided": "cannot"
                            },
                            "hint": "Remember to subtract the current value from the subsequent value if current is less; otherwise, just add the current value."
                        }
                    }
                },
                "2": {
                    "description": "Initialize a variable to hold the resulting integer value from the conversion.",
                    "status": {
                        "correctness": "correct",
                        "can be further divided": "cannot"
                    },
                    "hint": "",
                    "lineNumber": "13",
                    "subSteps_display": 'yes'
                },
                "3": {
                    "description": "Iterate over the characters of the input Roman numeral string.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "can"
                    },
                    "hint": "Think about how you can create a loop to check each character within the Roman numeral string.",
                    "lineNumber": "",
                    "subSteps_display": 'no',
                    "subSteps": {
                        "sub-step 1": {
                            "description": "Start a loop that will go through each character in the string.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can use a 'for' loop to iterate over each character in the string."
                        }
                    }
                },
                "4": {
                    "description": "Compare the current numeral value with the next one to identify if subtraction is needed.",
                    "status": {
                        "correctness": "incorrect",
                        "can be further divided": "can"
                    },
                    "hint": "Figure out a way to look ahead to the next character in the string—if the current character's value is less than the next one, a subtraction operation is needed.",
                    "lineNumber": "",
                    "subSteps_display": 'no',
                    "subSteps": {
                        "sub-step 1": {
                            "description": "Check if the current numeral is not the last one in the string.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can prevent out-of-bounds errors by ensuring the current index is less than the length of the string minus one."
                        },
                        "sub-step 2": {
                            "description": "Test if the numeral's value is less than the value of the next numeral.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can use the mapping you created earlier to compare the integer values of the current and next numeral characters."
                        },
                        "sub-step 3": {
                            "description": "Apply subtraction when needed and addition otherwise.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "Remember to subtract the current value from the subsequent value if current is less; otherwise, just add the current value."
                        }
                    }
                },
                "5": {
                    "description": "Handle the last numeral in the string, if it has not been processed yet.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Make sure you've added the value of the last numeral after completing the loop, as there won't be a next numeral to compare it to.",
                    "lineNumber": "",
                    "subSteps_display": 'no'
                }
            }
        };

        var stepsData_test2 = {
            "steps": {
                "1": {
                    "description": "Create a mapping from Roman numeral characters to their integer values.",
                    "status": {
                        "correctness": "correct",
                        "can be further divided": "can"
                    },
                    "hint": "",
                    "lineNumber": "[3, 4, 5, 6, 7, 8, 9, 10, 11]",
                    "subSteps_display": 'yes',
                    "subSteps": {
                        "sub-step 1": {
                            "description": "Check if the current numeral is not the last one in the string.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can prevent out-of-bounds errors by ensuring the current index is less than the length of the string minus one."
                        },
                        "sub-step 2": {
                            "description": "Test if the numeral's value is less than the value of the next numeral.",
                            "status": {
                                "correctness": "incorrect",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can use the mapping you created earlier to compare the integer values of the current and next numeral characters."
                        },
                        "sub-step 3": {
                            "description": "Apply subtraction when needed and addition otherwise.",
                            "status": {
                                "correctness": "correct",
                                "can be further divided": "cannot"
                            },
                            "hint": "Remember to subtract the current value from the subsequent value if current is less; otherwise, just add the current value."
                        }
                    }
                },
                "2": {
                    "description": "Initialize a variable to hold the resulting integer value from the conversion.",
                    "status": {
                        "correctness": "correct",
                        "can be further divided": "cannot"
                    },
                    "hint": "",
                    "lineNumber": "13",
                    "subSteps_display": 'yes'
                },
                "3": {
                    "description": "Iterate over the characters of the input Roman numeral string.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "can"
                    },
                    "hint": "Think about how you can create a loop to check each character within the Roman numeral string.",
                    "lineNumber": "",
                    "subSteps_display": 'no',
                    "subSteps": {
                        "sub-step 1": {
                            "description": "Start a loop that will go through each character in the string.",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can use a 'for' loop to iterate over each character in the string."
                        }
                    }
                },
                "4": {
                    "description": "Compare the current numeral value with the next one to identify if subtraction is needed.",
                    "status": {
                        "correctness": "incorrect",
                        "can be further divided": "can"
                    },
                    "hint": "Figure out a way to look ahead to the next character in the string—if the current character's value is less than the next one, a subtraction operation is needed.",
                    "lineNumber": "",
                    "subSteps_display": 'yes',
                    "subSteps": {
                        "sub-step 1": {
                            "description": "",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can prevent out-of-bounds errors by ensuring the current index is less than the length of the string minus one."
                        },
                        "sub-step 2": {
                            "description": "Test if the numeral's value is less than the value of the next numeral.",
                            "status": {
                                "correctness": "correct",
                                "can be further divided": "cannot"
                            },
                            "hint": "You can use the mapping you created earlier to compare the integer values of the current and next numeral characters."
                        },
                        "sub-step 3": {
                            "description": "",
                            "status": {
                                "correctness": "missing",
                                "can be further divided": "cannot"
                            },
                            "hint": "Remember to subtract the current value from the subsequent value if current is less; otherwise, just add the current value."
                        }
                    }
                },
                "5": {
                    "description": "Handle the last numeral in the string, if it has not been processed yet.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Make sure you've added the value of the last numeral after completing the loop, as there won't be a next numeral to compare it to.",
                    "lineNumber": "",
                    "subSteps_display": 'no'
                }
            }
        };

        var step2 = {
            "steps": {
                "1": {
                "description": "Create a mapping from Roman numeral characters to their integer values.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "can"
                },
                "hint": "Ensure that each Roman numeral symbol is correctly associated with its integer value.",
                "correct_step": "Create a dictionary in Python where each Roman numeral character ('I', 'V', 'X', 'L', 'C', 'D', 'M') is a key, and the corresponding integer values are the values.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Define a dictionary in your programming language.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a dictionary data structure to store key-value pairs, where the keys are the Roman numerals and the values are the integers."
                    },
                    "sub-step 2": {
                    "description": "Populate the dictionary with correct Roman numeral-to-integer mappings.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Include all seven symbols and their values in the dictionary to ensure complete coverage."
                    }
                }
                },
                "2": {
                "description": "Initialize a variable to hold the resulting integer value from the conversion.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "cannot"
                },
                "hint": "This variable will be used to accumulate the value as you parse the Roman numeral."
                },
                "3": {
                "description": "Iterate over the Roman numeral string from right to left.",
                "status": {
                    "correctness": "missing",
                    "can be further divided": "can"
                },
                "hint": "Consider using a loop that starts from the end of the string and moves to the beginning.",
                "correct_step": "Implement a loop to process each character of the Roman numeral string from its end to the start.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Get the length of the Roman numeral string.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a function or property that can retrieve the number of characters in a string."
                    },
                    "sub-step 2": {
                    "description": "Use a loop that decrements to ensure you start from the last character.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "This can be done using a for loop or a while loop, depending on your comfort with your programming language."
                    }
                }
                },
                "4": {
                "description": "Add or subtract values based on Roman numeral rules.",
                "status": {
                    "correctness": "missing",
                    "can be further divided": "can"
                },
                "hint": "Remember that if a smaller numeral is before a larger numeral, you should subtract the smaller from the total, otherwise add it.",
                "correct_step": "Apply the Roman numeral subtraction rules correctly when processing each numeral.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Check the value of the current numeral against the value of the numeral before it.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "You'll need to compare the current character's mapped value to the next character's to decide if you should add or subtract."
                    },
                    "sub-step 2": {
                    "description": "Apply addition or subtraction based on the comparison.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "If the current numeral is less than the next one, subtract its value from your total; otherwise, add it."
                    }
                }
                }
            }
        };


        var demo_step1 = {
            "steps": {
                "1": {
                "description": "Create a mapping from Roman numeral characters to their integer values.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "can"
                },
                "hint": "Ensure that each Roman numeral symbol is correctly associated with its integer value.",
                "lineNumber": "[3, 4, 5, 6, 7, 8, 9, 10, 11]",
                "correct_step": "Create a dictionary in Python where each Roman numeral character ('I', 'V', 'X', 'L', 'C', 'D', 'M') is a key, and the corresponding integer values are the values.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Define a dictionary in your programming language.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a dictionary data structure to store key-value pairs, where the keys are the Roman numerals and the values are the integers."
                    },
                    "sub-step 2": {
                    "description": "Populate the dictionary with correct Roman numeral-to-integer mappings.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Include all seven symbols and their values in the dictionary to ensure complete coverage."
                    }
                }
                },
                "2": {
                "description": "Initialize a variable to hold the resulting integer value from the conversion.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "cannot"
                },
                "hint": "This variable will be used to accumulate the value as you parse the Roman numeral.",
                "lineNumber": "[13]",
                },
                "3": {
                "description": "Iterate over the Roman numeral string from right to left.",
                "status": {
                    "correctness": "missing",
                    "can be further divided": "can"
                },
                "hint": "Consider using a loop that starts from the end of the string and moves to the beginning.",
                "correct_step": "Implement a loop to process each character of the Roman numeral string from its end to the start.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Get the length of the Roman numeral string.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a function or property that can retrieve the number of characters in a string."
                    },
                    "sub-step 2": {
                    "description": "Use a loop that decrements to ensure you start from the last character.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "This can be done using a for loop or a while loop, depending on your comfort with your programming language."
                    }
                }
                },
                "4": {
                "description": "Add or subtract values based on Roman numeral rules.",
                "status": {
                    "correctness": "missing",
                    "can be further divided": "can"
                },
                "hint": "Remember that if a smaller numeral is before a larger numeral, you should subtract the smaller from the total, otherwise add it.",
                "correct_step": "Apply the Roman numeral subtraction rules correctly when processing each numeral.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Check the value of the current numeral against the value of the numeral before it.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "You'll need to compare the current character's mapped value to the next character's to decide if you should add or subtract."
                    },
                    "sub-step 2": {
                    "description": "Apply addition or subtraction based on the comparison.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "If the current numeral is less than the next one, subtract its value from your total; otherwise, add it."
                    }
                }
                }
            }
        };



        var demo_step2 = {
            "steps": {
                "1": {
                "description": "Create a mapping from Roman numeral characters to their integer values.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "can"
                },
                "hint": "Ensure that each Roman numeral symbol is correctly associated with its integer value.",
                "correct_step": "Create a dictionary in Python where each Roman numeral character ('I', 'V', 'X', 'L', 'C', 'D', 'M') is a key, and the corresponding integer values are the values.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Define a dictionary in your programming language.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a dictionary data structure to store key-value pairs, where the keys are the Roman numerals and the values are the integers."
                    },
                    "sub-step 2": {
                    "description": "Populate the dictionary with correct Roman numeral-to-integer mappings.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Include all seven symbols and their values in the dictionary to ensure complete coverage."
                    }
                }
                },
                "2": {
                "description": "Initialize a variable to hold the resulting integer value from the conversion.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "cannot"
                },
                "hint": "This variable will be used to accumulate the value as you parse the Roman numeral."
                },
                "3": {
                "description": "Iterate over the Roman numeral string from right to left.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "can"
                },
                "hint": "Consider using a loop that starts from the end of the string and moves to the beginning.",
                "correct_step": "Implement a loop to process each character of the Roman numeral string from its end to the start.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Get the length of the Roman numeral string.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a function or property that can retrieve the number of characters in a string."
                    },
                    "sub-step 2": {
                    "description": "Use a loop that decrements to ensure you start from the last character.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "This can be done using a for loop or a while loop, depending on your comfort with your programming language."
                    }
                }
                },
                "4": {
                "description": "Add or subtract values based on Roman numeral rules.",
                "status": {
                    "correctness": "missing",
                    "can be further divided": "can"
                },
                "hint": "Remember that if a smaller numeral is before a larger numeral, you should subtract the smaller from the total, otherwise add it.",
                "correct_step": "Apply the Roman numeral subtraction rules correctly when processing each numeral.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Check the value of the current numeral against the value of the numeral before it.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "You'll need to compare the current character's mapped value to the next character's to decide if you should add or subtract."
                    },
                    "sub-step 2": {
                    "description": "Apply addition or subtraction based on the comparison.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "If the current numeral is less than the next one, subtract its value from your total; otherwise, add it."
                    }
                }
                }
            }
        };



        var demo_step3 = {
            "steps": {
                "1": {
                "description": "Create a mapping from Roman numeral characters to their integer values.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "can"
                },
                "hint": "Ensure that each Roman numeral symbol is correctly associated with its integer value.",
                "correct_step": "Create a dictionary in Python where each Roman numeral character ('I', 'V', 'X', 'L', 'C', 'D', 'M') is a key, and the corresponding integer values are the values.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Define a dictionary in your programming language.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a dictionary data structure to store key-value pairs, where the keys are the Roman numerals and the values are the integers."
                    },
                    "sub-step 2": {
                    "description": "Populate the dictionary with correct Roman numeral-to-integer mappings.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Include all seven symbols and their values in the dictionary to ensure complete coverage."
                    }
                }
                },
                "2": {
                "description": "Initialize a variable to hold the resulting integer value from the conversion.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "cannot"
                },
                "hint": "This variable will be used to accumulate the value as you parse the Roman numeral."
                },
                "3": {
                "description": "Iterate over the Roman numeral string from right to left.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "can"
                },
                "hint": "Consider using a loop that starts from the end of the string and moves to the beginning.",
                "correct_step": "Implement a loop to process each character of the Roman numeral string from its end to the start.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Get the length of the Roman numeral string.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a function or property that can retrieve the number of characters in a string."
                    },
                    "sub-step 2": {
                    "description": "Use a loop that decrements to ensure you start from the last character.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "This can be done using a for loop or a while loop, depending on your comfort with your programming language."
                    }
                }
                },
                "4": {
                "description": "Add or subtract values based on Roman numeral rules.",
                "status": {
                    "correctness": "incorrect",
                    "can be further divided": "can"
                },
                "hint": "Remember that if a smaller numeral is before a larger numeral, you should subtract the smaller from the total, otherwise add it.",
                "correct_step": "Apply the Roman numeral subtraction rules correctly when processing each numeral.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Check the value of the current numeral against the value of the numeral before it.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "You'll need to compare the current character's mapped value to the next character's to decide if you should add or subtract."
                    },
                    "sub-step 2": {
                    "description": "Apply addition or subtraction based on the comparison.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "If the current numeral is less than the next one, subtract its value from your total; otherwise, add it."
                    }
                }
                }
            }
        };


        var demo_step4 = {
            "steps": {
                "1": {
                "description": "Create a mapping from Roman numeral characters to their integer values.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "can"
                },
                "hint": "Ensure that each Roman numeral symbol is correctly associated with its integer value.",
                "correct_step": "Create a dictionary in Python where each Roman numeral character ('I', 'V', 'X', 'L', 'C', 'D', 'M') is a key, and the corresponding integer values are the values.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Define a dictionary in your programming language.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a dictionary data structure to store key-value pairs, where the keys are the Roman numerals and the values are the integers."
                    },
                    "sub-step 2": {
                    "description": "Populate the dictionary with correct Roman numeral-to-integer mappings.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Include all seven symbols and their values in the dictionary to ensure complete coverage."
                    }
                }
                },
                "2": {
                "description": "Initialize a variable to hold the resulting integer value from the conversion.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "cannot"
                },
                "hint": "This variable will be used to accumulate the value as you parse the Roman numeral."
                },
                "3": {
                "description": "Iterate over the Roman numeral string from right to left.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "can"
                },
                "hint": "Consider using a loop that starts from the end of the string and moves to the beginning.",
                "correct_step": "Implement a loop to process each character of the Roman numeral string from its end to the start.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Get the length of the Roman numeral string.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a function or property that can retrieve the number of characters in a string."
                    },
                    "sub-step 2": {
                    "description": "Use a loop that decrements to ensure you start from the last character.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "This can be done using a for loop or a while loop, depending on your comfort with your programming language."
                    }
                }
                },
                "4": {
                "description": "Check the value of the current numeral against the value of the numeral before it.",
                "status": {
                    "correctness": "missing",
                    "can be further divided": "cannot"
                },
                "hint": "Remember that if a smaller numeral is before a larger numeral, you should subtract the smaller from the total, otherwise add it.",
                "correct_step": "Apply the Roman numeral subtraction rules correctly when processing each numeral."
                },
                "5": {
                "description": "Apply addition or subtraction based on the comparison.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "cannot"
                }
                }
            }
        };




        var demo_step5 = {
            "steps": {
                "1": {
                "description": "Create a mapping from Roman numeral characters to their integer values.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "can"
                },
                "hint": "Ensure that each Roman numeral symbol is correctly associated with its integer value.",
                "correct_step": "Create a dictionary in Python where each Roman numeral character ('I', 'V', 'X', 'L', 'C', 'D', 'M') is a key, and the corresponding integer values are the values.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Define a dictionary in your programming language.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a dictionary data structure to store key-value pairs, where the keys are the Roman numerals and the values are the integers."
                    },
                    "sub-step 2": {
                    "description": "Populate the dictionary with correct Roman numeral-to-integer mappings.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Include all seven symbols and their values in the dictionary to ensure complete coverage."
                    }
                }
                },
                "2": {
                "description": "Initialize a variable to hold the resulting integer value from the conversion.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "cannot"
                },
                "hint": "This variable will be used to accumulate the value as you parse the Roman numeral."
                },
                "3": {
                "description": "Iterate over the Roman numeral string from right to left.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "can"
                },
                "hint": "Consider using a loop that starts from the end of the string and moves to the beginning.",
                "correct_step": "Implement a loop to process each character of the Roman numeral string from its end to the start.",
                "subSteps": {
                    "sub-step 1": {
                    "description": "Get the length of the Roman numeral string.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "Use a function or property that can retrieve the number of characters in a string."
                    },
                    "sub-step 2": {
                    "description": "Use a loop that decrements to ensure you start from the last character.",
                    "status": {
                        "correctness": "missing",
                        "can be further divided": "cannot"
                    },
                    "hint": "This can be done using a for loop or a while loop, depending on your comfort with your programming language."
                    }
                }
                },
                "4": {
                "description": "Check the value of the current numeral against the value of the numeral before it.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "cannot"
                },
                "hint": "Remember that if a smaller numeral is before a larger numeral, you should subtract the smaller from the total, otherwise add it.",
                "correct_step": "Apply the Roman numeral subtraction rules correctly when processing each numeral."
                },
                "5": {
                "description": "Apply addition or subtraction based on the comparison.",
                "status": {
                    "correctness": "correct",
                    "can be further divided": "cannot"
                }
                }
            }
        };





        document.getElementById('language-selector').addEventListener('change', function() {
            var language = this.value;
            var mode = 'text/plain'; // 默认模式为纯文本
            switch (language) {
                case 'python':
                    mode = 'python';
                    break;
                case 'javascript':
                    mode = 'javascript';
                    break;
                case 'java':
                    mode = 'text/x-java'; // 对于Java，使用特定的mime类型
                    break;
                case 'c++':
                    mode = 'text/x-c++src'; // 对于C++，使用特定的mime类型
                    break;
                // 可根据需要添加更多语言支持
            }
            editor.setOption('mode', mode);
        });















    function loadSteps_fromBlock(stepsData) {
            var container = document.getElementById('steps-container');
            container.innerHTML = ''; // 清空所有内容

            var steps = [];
            var weights = [];
            var totalWeight = 0;
            var lastStepWasMissing = false;
            var combinedStepDiv = null;
            var combinedHints = '';
            var combinedWeight = 0;


            console.log(stepsData)

            missing_count = 0;

            var missing_json = {};
            // TypeError: Cannot convert undefined or null to object
            Object.entries(stepsData.steps).forEach(([stepNumber, step]) => {
                var subStepCount = step.subSteps ? Object.keys(step.subSteps).length : 0;
                var stepWeight = 1 + subStepCount * 0.5; // 基础权重加上子步骤的权重

                if (step.status.correctness === "missing") {
                    missing_count += 1;
                    if (!lastStepWasMissing) {
                        combinedStepDiv = document.createElement('div');
                        combinedStepDiv.id = generateUUID();
                        combinedStepDiv.className = 'step missing';
                        combinedStepDiv.style.display = 'flex';
                        combinedStepDiv.style.flexDirection = 'column'; // 确保内容和子步骤垂直排列


                        if (step.status["can be further divided"] == "can"){
                            combinedStepDiv.classList.add("can-be-divided");
                        }

                        container.appendChild(combinedStepDiv);

                        renumberSteps(container);

                        addEditableTextContainer(combinedStepDiv, "");
                        addSplitButton(combinedStepDiv);
                        addRemoveButton(combinedStepDiv);
                        addAddSubStepButton(combinedStepDiv); // 添加C.png按钮
                        combinedWeight = stepWeight;
                        lastStepWasMissing = true;


                    } else {
                        combinedWeight += stepWeight; // 累积合并步骤的权重
                    }
                    combinedHints += step.hint ? step.hint + '\n' : '';

                    missing_json[missing_count] = step;
                } else {
                    if (lastStepWasMissing) {
                        weights.push(combinedWeight); // 把合并的权重加入数组
                        steps.push(combinedStepDiv);
                        addIconsAndHint(combinedStepDiv, combinedHints, missing_json);
                        combinedHints = '';
                        combinedWeight = 0;
                        lastStepWasMissing = false;
                    }
                    console.log(step)
                    // var stepDiv = createStepDiv(step, container);

                    // 要对比着进行createStepDiv
                    var stepDiv = createStepDiv_conditionallyAdd(step, container, user_history_stepsData[user_history_stepsData.length - 1]);

                    console.log(stepDiv)

                    if (stepDiv !== null){
                        steps.push(stepDiv);
                        weights.push(stepWeight);
                    }
                    
                }
            });

            if (lastStepWasMissing) {
                weights.push(combinedWeight);
                steps.push(combinedStepDiv);
                addIconsAndHint(combinedStepDiv, combinedHints, missing_json);
            }

            // 根据权重调整每个步骤的高度
            totalWeight = weights.reduce((sum, weight) => sum + weight, 0);

            console.log('here')
            console.log(steps)
            adjustBlockHeightsWithWeights(container, steps, weights, totalWeight);
        }








        function loadSteps(stepsData) {
            var container = document.getElementById('steps-container');
            container.innerHTML = ''; // 清空所有内容

            var steps = [];
            var weights = [];
            var totalWeight = 0;
            var lastStepWasMissing = false;
            var combinedStepDiv = null;
            var combinedHints = '';
            var combinedWeight = 0;


            console.log(stepsData)

            missing_count = 0;

            var missing_json = {};



            Object.entries(stepsData.steps).forEach(([stepNumber, step]) => {
                var subStepCount = step.subSteps ? Object.keys(step.subSteps).length : 0;
                var stepWeight = 1 + subStepCount * 0.5; // 基础权重加上子步骤的权重

                if (step.status.correctness === "missing") {
                    missing_count += 1;

                    if (!lastStepWasMissing) {
                        combinedStepDiv = document.createElement('div');
                        combinedStepDiv.id = generateUUID();
                        combinedStepDiv.className = 'step missing';
                        combinedStepDiv.style.display = 'flex';
                        combinedStepDiv.style.flexDirection = 'column'; // 确保内容和子步骤垂直排列

                        if (step.status["can be further divided"] == "can"){
                            combinedStepDiv.classList.add("can-be-divided");
                        }
                        container.appendChild(combinedStepDiv);
                        
                        renumberSteps(container);

                        addEditableTextContainer(combinedStepDiv, "");
                        addSplitButton(combinedStepDiv);
                        addRemoveButton(combinedStepDiv);
                        addAddSubStepButton(combinedStepDiv); // 添加C.png按钮
                        combinedWeight = stepWeight;
                        lastStepWasMissing = true;
                    } else {
                        combinedWeight += stepWeight; // 累积合并步骤的权重
                    }
                    combinedHints += step.hint ? step.hint + '\n' : '';
                    missing_json[missing_count] = step;

                } else {
                    if (lastStepWasMissing) {
                        weights.push(combinedWeight); // 把合并的权重加入数组
                        steps.push(combinedStepDiv);
                        addIconsAndHint(combinedStepDiv, combinedHints, missing_json);
                        combinedHints = '';
                        combinedWeight = 0;
                        lastStepWasMissing = false;
                    }
                    console.log(step)
                    var stepDiv = createStepDiv(step, container);

                    steps.push(stepDiv);
                    weights.push(stepWeight);

                    hiddenbydefault();
                }
            });

            if (lastStepWasMissing) {
                weights.push(combinedWeight);
                steps.push(combinedStepDiv);
                addIconsAndHint(combinedStepDiv, combinedHints, missing_json);
            }

            // 根据权重调整每个步骤的高度
            totalWeight = weights.reduce((sum, weight) => sum + weight, 0);

            adjustBlockHeightsWithWeights(container, steps, weights, totalWeight);
        }















        function adjustBlockHeightsWithWeights(container, steps, weights, totalWeight) {
            let totalHeight = container.clientHeight;

            console.log(container.clientHeight)

            // 计算总边距、边框和填充
            let totalMarginPaddingBorder = Array.from(steps).reduce((total, step) => {
                let style = window.getComputedStyle(step);
                let margin = parseFloat(style.marginTop) + parseFloat(style.marginBottom);
                let border = parseFloat(style.borderTopWidth) + parseFloat(style.borderBottomWidth);
                let padding = parseFloat(style.paddingTop) + parseFloat(style.paddingBottom);
                return total + margin + border + padding;
            }, 0);

            console.log(totalMarginPaddingBorder)
            // 根据权重分配高度
            let totalAvailableHeight = totalHeight - totalMarginPaddingBorder;
            steps.forEach((step, index) => {
                let height = (weights[index] / totalWeight) * totalAvailableHeight;
                step.style.height = `${height}px`;
            });
        }



        function generateUUID() { // Public Domain/MIT
            var d = new Date().getTime();//Timestamp
            var d2 = (performance && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16;//random number between 0 and 16
                if(d > 0){//Use timestamp until depleted
                    r = (d + r)%16 | 0;
                    d = Math.floor(d/16);
                } else {//Use microseconds since page-load if supported
                    r = (d2 + r)%16 | 0;
                    d2 = Math.floor(d2/16);
                }
                return (c === 'x' ? r : (r&0x3 | 0x8)).toString(16);
            });
        }













        // =====================================================
        //下面是我的一些心路历程，最后已经解决了

        // 这里添加判断条件，只有满足条件才显示substep
        
        // 该步骤对应在UI中，是否展开了子步骤
        // 该步骤实际是否具有子步骤
        // 该步骤用户错误的次数是否达到了2次



        // 先根据最新UI中的步骤树 & GPT生成的步骤树（看user previous input字段），判断哪些step是新加的（GPT发现的missing），构建一个mapping，这样，判断GPT中某个步骤（1）错了几次，（2）是否界面中已有展开，就可以较为准确地对应上了

        // 界面中是否已有展开好判断，可是如何判断用户错了几次呢？GPT最新步骤树<-->最新的UI，倒数第二次UI<-->GPT倒数第二新的步骤树，这俩mapping能构建起来了，可以彼此之间怎么构建联系呢？
        // UI对UI（通过id对应，但是很可能用户删除掉某个box，导致id丢失），还是步骤树对步骤树（没有什么关系啊）？


        // 不论正确错误还是missing box，都有一个专属的id
        // 存储当前UI中的步骤树为两个json，一个是内容json，只有内容（传给GPT用），一个是id json，还有id，把id json存储到一个list中
        // 根据GPT生成的步骤树，与id json对应起来，更新id json中各步骤的状态，以及把missing添加进来
        // 这样，很容易就判断界面中是否已经有展开了，结合最新的id json和倒数第二新的id json，也可以判断用户是否错误了两次

        // 先不考虑这么复杂的问题了，接下来，假设UI中的步骤树与GPT生成的步骤树是一一对应的


        // =====================================================



        // 更改下面的函数，完成下面四个要求：（1）stepDiv和subStepDiv的id设置为step和substep的id，
        // （2）只有当originalJson中对应id的step存在substeps的时候，才创建subStepsContainer和subStepDiv，
        // （3）只有step或substep的id在originalJson中能找到对应的项的时候，才创建step或subStepDiv，且将textDiv.textContent设置为student current input，
        // （4）当originalJson中对应id的step的classname中包含incorrect，而且该step中的status也是incorrect的时候，满足这两个条件的基础上，
        // 如果该step中不存在substep，就直接把该step的textDiv.textContent设置为step的description；如果该step中存在substep，就直接把该step的所有subStepDiv创建出来，
        // 但是只有最后一个substep是有内容的，textDiv.textContent设置为description。


        function createStepDiv_conditionallyAdd(step, container, originalJson) {


            // // 计算当前 step 的编号
            // var stepNumber = 1;

            // for (var i = 0; i < container.children.length; i++) {
            //     if (container.children[i] === step) {
            //         stepNumber = i + 1; // 位置从 1 开始
            //         break;
            //     }
            // }



            // // 创建编号元素
            // var stepNumberDiv = document.createElement('div');
            // stepNumberDiv.className = 'step-number';
            // stepNumberDiv.textContent = `${stepNumber}`;
            // stepNumberDiv.style.position = 'absolute';
            // stepNumberDiv.style.top = '5px';
            // stepNumberDiv.style.right = '5px';
            // stepNumberDiv.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            // stepNumberDiv.style.color = 'white';
            // stepNumberDiv.style.padding = '2px 5px';
            // stepNumberDiv.style.borderRadius = '3px';
            // stepNumberDiv.style.fontSize = '12px';








            console.log(step)
            console.log(originalJson)
            // 查找originalJson中对应id的step
            let originalStep = null;
            for (let key in originalJson) {
                if (originalJson[key].id === step.id) {
                    originalStep = originalJson[key];
                    break;
                }
            }
            if (!originalStep) {
                return null; // 如果不存在对应的step，不创建
            }

            var stepDiv = document.createElement('div');



            // stepDiv.appendChild(stepNumberDiv);






            stepDiv.id = step.id; // 设置为step的id
            stepDiv.className = `step ${step.status.correctness}`;
            if (step.status["can be further divided"] == "can"){
                stepDiv.classList.add("can-be-divided");
            }
            stepDiv.style.display = 'flex';
            stepDiv.style.flexDirection = 'column'; // 确保内容和子步骤垂直排列

            // var textDiv = document.createElement('div');
            // textDiv.className = 'text-content';
            // textDiv.setAttribute('contenteditable', 'true');


            var textDiv = document.createElement('textarea');
            textDiv.className = 'text-content';

            // 设置占位符内容
            textDiv.setAttribute('placeholder', 'Input Your Thoughts');




            // 设置textContent为student current input
            textDiv.textContent = step['student current input'];
            stepDiv.appendChild(textDiv);

            var step_json = {};
            step_json["1"] = step;

            addIconsAndHint(stepDiv, step.hint, step_json);
            addSplitButton(stepDiv);
            addRemoveButton(stepDiv);
            addAddSubStepButton(stepDiv); // 添加C.png按钮

            container.appendChild(stepDiv); // 添加主步骤到容器
            renumberSteps(container);

            console.log(originalStep)
            console.log(originalStep["substeps"])
            console.log(Object.keys(originalStep["substeps"]).length > 0)


            // 检查originalJson中对应的step是否存在substeps          
            if (originalStep.substeps && Object.keys(originalStep.substeps).length > 0 && step.subSteps && Object.keys(step.subSteps).length > 0) {
                var subStepsContainer = document.createElement('div');
                subStepsContainer.className = 'substeps-container';
                stepDiv.appendChild(subStepsContainer); // 将子步骤容器添加到主步骤下方




                // 创建折叠/展开图标
                var toggleIcon = document.createElement('span');
                toggleIcon.className = 'toggle-icon';
                toggleIcon.innerHTML = '&#9654;'; // 展开图标符号
                stepDiv.insertBefore(toggleIcon, subStepsContainer);

                // 折叠/展开功能
                toggleIcon.addEventListener('click', function() {
                    if (subStepsContainer.style.display === 'none') {
                        subStepsContainer.style.display = 'flex';
                        toggleIcon.innerHTML = '&#9660;'; // 折叠图标符号
                    } else {
                        subStepsContainer.style.display = 'none';
                        toggleIcon.innerHTML = '&#9654;'; // 展开图标符号
                    }
                });
        



        
                // 这里有点问题，虽然originalStep有substep，但是如果GPT回馈过来的json，step下面不存在substep怎么办？


                if (step.subSteps && Object.keys(step.subSteps).length > 0) {
                    Object.entries(step.subSteps).forEach(([subStepId, subStep]) => {
                        // 查找originalJson中对应id的substep
                        let originalSubStep = null;
                        for (let key in originalStep.substeps) {
                            console.log(originalStep.substeps[key].id)
                            console.log(subStep.id)
                            if (originalStep.substeps[key].id === subStep.id) {
                                originalSubStep = originalStep.substeps[key];
                                break;
                            }

                            // 但是如果正确答案比原始用户输入多了一些用户missing的部分，这时候id肯定也是对应不起来的，但是仍然要显示出来，所以只根据id匹配，判断!originalSubStep就return是不对的。
                            if (originalStep.substeps[key].id != subStep.id && subStep.status.correctness == "missing"){
                                originalSubStep = originalStep.substeps[key];
                            }
                        }
                        if (!originalSubStep) {
                            console.log('break')
                            return; // 如果不存在对应的substep，不创建
                        }

                        

                        var subStepDiv = document.createElement('div');
                        subStepDiv.id = subStep.id; // 设置为substep的id
                        subStepDiv.className = `substep ${subStep.status.correctness}`;
                        if (subStep.status["can be further divided"] == "can"){
                            subStepDiv.classList.add("can-be-divided");
                        }
                        subStepDiv.innerHTML = `
                            <textarea class='text-content' placeholder='Input Your Thoughts'>${subStep['student current input']}</textarea>
                        `;

                        var step_json = {};
                        step_json["1"] = subStep;


                        addIconsAndHint(subStepDiv, subStep.hint, step_json);
                        addSplitButton_substep(subStepDiv, subStepsContainer); // 为子步骤添加添加和删除按钮
                        addRemoveButton_substep(subStepDiv, subStepsContainer); // 调整为传递父容器
                        addAddSubStepButton(subStepDiv);
                        subStepsContainer.appendChild(subStepDiv);
                        renumberSteps(subStepsContainer);
                    });
                
                
                }
                // 如果只是originalStep有substep，但是GPT回馈过来的json，step下面不存在substep，这时候应该怎么办？主要是用户输入的substep，很可能没有被GPT evaluate啊，所以只是展示出来没有意义啊。索性不展示了。
                else{
                    console.log('只是originalStep有substep，但是GPT回馈过来的json，step下面不存在substep');
                }




                // 计算和设置子步骤高度
                adjustSubStepHeights(subStepsContainer);
            }
            
            // // 处理step的className和status为incorrect的特殊情况
            // if (originalStep.status.includes('incorrect') && step.status.correctness === 'incorrect') {
                
            //     if (!step.subSteps || Object.keys(step.subSteps).length === 0) {
            //         console.log(step)
            //         console.log(step.correctStep)
            //         // 没有子步骤，直接设置textDiv.textContent为step的correctStep
            //         textDiv.textContent = step.correctStep;
            //         // 同时设置class为蓝色info色
            //         stepDiv.className = `step info`;
            //     } else {
            //         // 有子步骤，创建所有subStepDiv，只有最后一个subStep有内容
            //         var subStepsContainer = document.createElement('div');
            //         subStepsContainer.className = 'substeps-container';
            //         stepDiv.appendChild(subStepsContainer);

            //         Object.entries(step.subSteps).forEach(([subStepId, subStep], index, array) => {
            //             var subStepDiv = document.createElement('div');
            //             subStepDiv.id = subStep.id;
            //             // 同时设置class为蓝色info色
            //             subStepDiv.className = `substep info`;

            //             console.log(index)
            //             console.log(array.length - 1)
            //             console.log(subStep)
            //             console.log(subStep.correctStep)
            //             // subStepDiv.className = `substep ${subStep.status.correctness}`;
            //             subStepDiv.innerHTML = `
            //                 <div class='text-content' contenteditable='true'>${index === array.length - 1 ? subStep.correctStep : ''}</div>
            //             `;
            //             addIconsAndHint(subStepDiv, subStep.hint);
            //             addSplitButton_substep(subStepDiv, subStepsContainer); // 为子步骤添加添加和删除按钮
            //             addRemoveButton_substep(subStepDiv, subStepsContainer); // 调整为传递父容器
            //             addAddSubStepButton(subStepDiv);
            //             subStepsContainer.appendChild(subStepDiv);
            //         });

            //         // 计算和设置子步骤高度
            //         adjustSubStepHeights(subStepsContainer);
            //     }
            // }

            return stepDiv;
        }







        function createStepDiv(step, container) {


            var stepDiv = document.createElement('div');



            stepDiv.id = generateUUID();

            stepDiv.className = `step ${step.status.correctness}`;
            if (step.status["can be further divided"] == "can"){
                stepDiv.classList.add("can-be-divided");
            }
            stepDiv.style.display = 'flex';
            stepDiv.style.flexDirection = 'column'; // 确保内容和子步骤垂直排列

            // var textDiv = document.createElement('div');
            // textDiv.className = 'text-content';
            // textDiv.setAttribute('contenteditable', 'true');

                           


            var textDiv = document.createElement('textarea');
            textDiv.className = 'text-content';

            // 设置占位符内容
            textDiv.setAttribute('placeholder', 'Input Your Thoughts');


            // 这里不应该是description，而是user previous input
            textDiv.textContent = step.correctStep;
            stepDiv.appendChild(textDiv);

            var step_json = {};
            step_json["1"] = step;


            addIconsAndHint(stepDiv, step.hint, step_json);
            addSplitButton(stepDiv);
            addRemoveButton(stepDiv);
            addAddSubStepButton(stepDiv); // 添加C.png按钮

            container.appendChild(stepDiv); // 添加主步骤到容器
            renumberSteps(container);




            // 确保文本和按钮被渲染后再计算
            setTimeout(() => {
            // 添加子步骤容器，如果有子步骤并且需要显示



            if (step.subSteps_display === 'yes' && step.subSteps) {
                var subStepsContainer = document.createElement('div');
                subStepsContainer.className = 'substeps-container';
                stepDiv.appendChild(subStepsContainer); // 将子步骤容器添加到主步骤下方



                // 创建折叠/展开图标
                var toggleIcon = document.createElement('span');
                toggleIcon.className = 'toggle-icon';
                toggleIcon.innerHTML = '&#9654;'; // 展开图标符号
                stepDiv.insertBefore(toggleIcon, subStepsContainer);

                // 折叠/展开功能
                toggleIcon.addEventListener('click', function() {
                    if (subStepsContainer.style.display === 'none') {
                        subStepsContainer.style.display = 'flex';
                        toggleIcon.innerHTML = '&#9660;'; // 折叠图标符号
                    } else {
                        subStepsContainer.style.display = 'none';
                        toggleIcon.innerHTML = '&#9654;'; // 展开图标符号
                    }
                });
        




                Object.entries(step.subSteps).forEach(([subStepId, subStep]) => {
                    var subStepDiv = document.createElement('div');
                    subStepDiv.id = generateUUID();
                    subStepDiv.className = `substep ${subStep.status.correctness}`;
                    if (subStep.status["can be further divided"] == "can"){
                        subStepDiv.classList.add("can-be-divided");
                    }
                    subStepDiv.innerHTML = `
                    <textarea class='text-content' placeholder='Input Your Thoughts'>${subStep.correctStep}</textarea>
                    `;







                    var step_json = {};
                    step_json["1"] = subStep;


                    addIconsAndHint(subStepDiv, subStep.hint, step_json);
                    addSplitButton_substep(subStepDiv, subStepsContainer); // 为子步骤添加添加和删除按钮
                    addRemoveButton_substep(subStepDiv, subStepsContainer); // 调整为传递父容器
                    addAddSubStepButton(subStepDiv);
                    subStepsContainer.appendChild(subStepDiv);
                    renumberSteps(subStepsContainer);
                });

                // 计算和设置子步骤高度
                adjustSubStepHeights(subStepsContainer);
            }
            }, 0);


            return stepDiv;
        }








function addAddSubStepButton(stepDiv) {
    var addButton = document.createElement('img');
    addButton.src = 'C.png';
    addButton.className = 'add-substep-button';
    addButton.style.position = 'absolute';
    addButton.style.right = '60px';
    addButton.style.bottom = '10px';
    stepDiv.appendChild(addButton);

    addButton.onclick = function() {
        var subStepsContainer = stepDiv.querySelector('.substeps-container');
        // if (!subStepsContainer) {
        //     subStepsContainer = document.createElement('div');
        //     subStepsContainer.className = 'substeps-container';
        //     stepDiv.appendChild(subStepsContainer); // 将子步骤容器添加到主步骤下方


            
        // }

        if (!subStepsContainer) {
            subStepsContainer = document.createElement('div');
            subStepsContainer.className = 'substeps-container';
            stepDiv.appendChild(subStepsContainer); // 将子步骤容器添加到主步骤下方

            // 创建折叠/展开图标
            var toggleIcon = document.createElement('span');
            toggleIcon.className = 'toggle-icon';
            toggleIcon.innerHTML = '&#9654;'; // 展开图标符号
            stepDiv.insertBefore(toggleIcon, subStepsContainer);

            // 折叠/展开功能
            toggleIcon.addEventListener('click', function() {
                if (subStepsContainer.style.display === 'none') {
                    subStepsContainer.style.display = 'flex';
                    toggleIcon.innerHTML = '&#9660;'; // 折叠图标符号
                } else {
                    subStepsContainer.style.display = 'none';
                    toggleIcon.innerHTML = '&#9654;'; // 展开图标符号
                }
            });
        }




        // 创建新的子步骤
        var newSubStepDiv = document.createElement('div');
        newSubStepDiv.id = generateUUID();
        newSubStepDiv.className = 'substep missing';
        newSubStepDiv.innerHTML = `<textarea class='text-content' placeholder='Input Your Thoughts'></textarea>`;







        addIconsAndHint(newSubStepDiv, "Try it!");
        addSplitButton_substep(newSubStepDiv, subStepsContainer); // 为子步骤添加添加和删除按钮
        addRemoveButton_substep(newSubStepDiv, subStepsContainer); // 调整为传递父容器
        addAddSubStepButton(newSubStepDiv);


        subStepsContainer.appendChild(newSubStepDiv); // 将新的子步骤添加到子步骤容器
        renumberSteps(subStepsContainer);

        adjustSubStepHeights(subStepsContainer); // 调整所有子步骤的高度

        hiddenbydefault();
    };
}







        function addSplitButton_substep(stepDiv, parentContainer) {
            var addButton = document.createElement('img');
            addButton.src = 'A.png';
            addButton.className = 'split-button';
            addButton.style.position = 'absolute';
            addButton.style.right = '35px';
            addButton.style.bottom = '10px';
            stepDiv.appendChild(addButton);

            addButton.onclick = function() {
                var newSubStepDiv = document.createElement('div');
                newSubStepDiv.id = generateUUID();
                newSubStepDiv.className = `substep missing`;
                newSubStepDiv.innerHTML = `
                <textarea class='text-content' placeholder='Input Your Thoughts'></textarea>
                `;






                addIconsAndHint(newSubStepDiv, "Try it!");
                addSplitButton_substep(newSubStepDiv, parentContainer);
                addRemoveButton_substep(newSubStepDiv, parentContainer);
                addAddSubStepButton(newSubStepDiv);
                newSubStepDiv.style.opacity = '0';
                parentContainer.appendChild(newSubStepDiv);
                renumberSteps(parentContainer);

                setTimeout(() => {
                    newSubStepDiv.style.opacity = '1';
                }, 10);
                adjustSubStepHeights(parentContainer);

                hiddenbydefault();
            };
        }

        
        function addRemoveButton_substep(stepDiv, parentContainer) {
            var removeButton = document.createElement('img');
            removeButton.src = 'B.png';
            removeButton.className = 'remove-button';
            removeButton.style.position = 'absolute';
            removeButton.style.right = '10px';
            removeButton.style.bottom = '10px';
            stepDiv.appendChild(removeButton);

            removeButton.onclick = function() {
                stepDiv.style.opacity = '0';
                setTimeout(() => {
                    parentContainer.removeChild(stepDiv);
                    adjustSubStepHeights(parentContainer);

                        // 异步方式改变透明度以触发动画
                        setTimeout(() => {
                            traverseStepsAndSubsteps_substep(parentContainer);
                        }, 400); // 微小延迟确保 DOM 已更新
                        console.log(parentContainer)
                }, 200); // 等待透明度动画完成

                hiddenbydefault();
            };
        }



        function addSplitButton(stepDiv) {
            // Add button
            var addButton = document.createElement('img');
            addButton.src = 'A.png';
            addButton.className = 'split-button';
            addButton.alt = 'Add';
            addButton.style.position = 'absolute';
            addButton.style.right = '35px';
            addButton.style.bottom = '10px';
            stepDiv.appendChild(addButton);

            addButton.onclick = function() {
                // Functionality to add a new block
                addNewBlock(stepDiv);

                hiddenbydefault();
            };


        }



        function addNewBlock(stepDiv) {
            var parentContainer = stepDiv.parentNode;






            var newBlock = document.createElement('div');
            newBlock.id = generateUUID();
            // newBlock.className = stepDiv.className;
            newBlock.className = `step`;


            newBlock.style.display = 'flex';
            newBlock.style.flexDirection = 'column'; // 确保内容和子步骤垂直排列

            // var textDiv = document.createElement('div');
            // textDiv.className = 'text-content';
            // textDiv.setAttribute('contenteditable', 'true');
            // textDiv.textContent = "?";

            var textDiv = document.createElement('textarea');
            textDiv.className = 'text-content';

            // 设置占位符内容
            textDiv.setAttribute('placeholder', 'Input Your Thoughts');




            newBlock.appendChild(textDiv);



            addIconsAndHint(newBlock, "Try it!");
            addSplitButton(newBlock);
            addRemoveButton(newBlock);
            addAddSubStepButton(newBlock);
            parentContainer.insertBefore(newBlock, stepDiv.nextSibling);

            renumberSteps(parentContainer);


            newBlock.style.opacity = '0'; // 开始时不可见


            // 异步方式改变透明度以触发动画
            setTimeout(() => {
                newBlock.style.opacity = '1';
            }, 10); // 微小延迟确保 DOM 已更新


            adjustBlockHeights(parentContainer);

            // 异步方式改变透明度以触发动画
            setTimeout(() => {
                traverseStepsAndSubsteps(parentContainer);
            }, 400); // 微小延迟确保 DOM 已更新
            
        }








        // function adjustBlockHeights(container) {

        //     let blocks = container.querySelectorAll('.step');
        //     let totalHeight = container.clientHeight;  // 容器的总高度

        //     // 计算所有块的总外边距
        //     let totalMargin = Array.from(blocks).reduce((total, block) => {
        //         let style = window.getComputedStyle(block);
        //         let margin = parseFloat(style.marginTop) + parseFloat(style.marginBottom);
        //         return total + margin;
        //     }, 0);


        //     console.log(totalHeight)
        //     console.log(totalMargin)
        //     // 计算每个块的内容可用高度
        //     let contentHeightPerBlock = (totalHeight - totalMargin) / blocks.length;

        //     // 设置每个块的高度，考虑 box-sizing: border-box
        //     blocks.forEach(block => {
        //         block.style.height = `${contentHeightPerBlock}px`; // 应用计算后的内容高度
        //     });
        // }



        function adjustBlockHeights(container) {


            // var parent = stepDiv.parentNode;

            // // 获取父容器中所有子元素
            // var children = parent.childNodes;

            // var index_num = '';

            // // 遍历子元素，找到 stepDiv 的位置
            // for (var i = 0; i < children.length; i++) {
            //     if (children[i] === stepDiv) {
            //         index_num = i + 1; // 返回 stepDiv 在父容器中的位置（从 1 开始）
            //     }
            // };


            // // 创建编号元素
            // var stepNumberDiv = document.createElement('div');
            // stepNumberDiv.className = 'step-number';
            // stepNumberDiv.textContent = `${index_num}`;
            // stepNumberDiv.style.position = 'absolute';
            // stepNumberDiv.style.top = '5px';
            // stepNumberDiv.style.right = '5px';
            // stepNumberDiv.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            // stepNumberDiv.style.color = 'white';
            // stepNumberDiv.style.padding = '2px 5px';
            // stepNumberDiv.style.borderRadius = '3px';







            let blocks = container.querySelectorAll('.step');
            let totalHeight = container.clientHeight; // 容器的总高度

            // 计算所有块的总外边距和当前高度
            let totalUsedHeight = Array.from(blocks).reduce((total, block) => {
                let style = window.getComputedStyle(block);
                let margin = parseFloat(style.marginTop) + parseFloat(style.marginBottom);
                let height = block.clientHeight;
                return total + margin + height; // 累加边距和当前高度
            }, 0);

            let currentHeight = Array.from(blocks).map(block => block.clientHeight);

            // 计算所有块的总高度占比
            let heightRatios = currentHeight.map(height => height / totalUsedHeight);

            let totalMargin = Array.from(blocks).reduce((total, block) => {
                let style = window.getComputedStyle(block);
                let margin = parseFloat(style.marginTop) + parseFloat(style.marginBottom);
                return total + margin;
            }, 0);

            // 计算除去外边距后的可用高度
            let availableHeight = totalHeight - totalMargin;

            // 根据原有高度比例分配每个块的高度
            blocks.forEach((block, index) => {
                let newHeight = availableHeight * heightRatios[index]; // 按比例计算新高度
                block.style.height = `${newHeight}px`; // 应用新高度
            });
        }






        function addRemoveButton(stepDiv){
            // Delete button
            var deleteButton = document.createElement('img');
            deleteButton.src = 'B.png';
            deleteButton.className = 'remove-button';
            deleteButton.alt = 'Delete';
            deleteButton.style.position = 'absolute';
            deleteButton.style.right = '10px';
            deleteButton.style.bottom = '10px';
            stepDiv.appendChild(deleteButton);

            deleteButton.onclick = function() {
                // Functionality to remove the current block
                var parentContainer = stepDiv.parentNode;
                // parentContainer.removeChild(stepDiv);
                // adjustBlockHeights(parentContainer);

                stepDiv.style.opacity = '0'; // 开始淡出
                    // 设置延时以匹配透明度过渡的时间，然后从 DOM 中移除
                    setTimeout(() => {
                        parentContainer.removeChild(stepDiv);
                        adjustBlockHeights(parentContainer); // 重新调整高度
                        
                        // 异步方式改变透明度以触发动画
                        setTimeout(() => {
                            traverseStepsAndSubsteps(parentContainer);
                        }, 400); // 微小延迟确保 DOM 已更新
                        console.log(parentContainer)

                    }, 200); // 确保与 CSS 中的过渡时间一致

                hiddenbydefault();
            };
            
        }







function adjustSubStepHeights(subStepsContainer) {


    var stepDiv = subStepsContainer.parentNode;
    var textDiv = stepDiv.firstElementChild;

    console.log(stepDiv)
    console.log(textDiv)
    // 计算除文本内容和按钮外的可用高度
    var totalHeight = stepDiv.clientHeight;
    var textHeight = textDiv.clientHeight;
    var buttonsHeight = 60;  // 假设按钮区域高度为35px
    var availableHeight = totalHeight - textHeight - buttonsHeight;
    subStepsContainer.style.height = `${availableHeight}px`;

    console.log("Available height:", availableHeight);



    // var subSteps = subStepsContainer.querySelectorAll('.substep');

    var subSteps = Array.from(subStepsContainer.children).filter(child => child.classList.contains('substep'));

    console.log(subStepsContainer)
    console.log(subSteps)
    var totalMarginPaddingBorder = Array.from(subSteps).reduce((total, subStep) => {
        let style = window.getComputedStyle(subStep);
        let margin = parseFloat(style.marginTop) + parseFloat(style.marginBottom);
        let border = parseFloat(style.borderTopWidth) + parseFloat(style.borderBottomWidth);
        let padding = parseFloat(style.paddingTop) + parseFloat(style.paddingBottom);
        return total + margin + border + padding;
    }, 0);

    // 计算所有子步骤除去边框、填充和边距后的实际可用高度
    // var availableHeight = subStepsContainer.offsetHeight - totalMarginPaddingBorder;
    var availableHeight = availableHeight - totalMarginPaddingBorder;
    var subStepHeight = availableHeight / subSteps.length;

    subSteps.forEach(subStep => {
        subStep.style.height = `${subStepHeight}px`;
    });

    console.log("Total container height:", availableHeight);
    console.log("Number of substeps:", subSteps.length);
    console.log("Each substep height:", subStepHeight);
}






// function traverseStepsAndSubsteps(parentContainer) {
//     // 获取父容器中的所有步骤
//     let steps = parentContainer.querySelectorAll('.step');
//     console.log(steps);
//     console.log(parentContainer);
//     // 遍历每个步骤
//     steps.forEach(step => {
//         console.log("Inspecting step:", step);  // 可以在这里处理每个步骤

//         // 在当前步骤中查找子步骤容器
//         let subStepsContainer = step.querySelector('.substeps-container');

//         // 检查是否找到子步骤容器
//         if (subStepsContainer) {
//             console.log("Found substeps container in step:", subStepsContainer);

//             // 如果需要，可以在这里继续处理找到的子步骤容器
//             adjustSubStepHeights(subStepsContainer);
//         } else {
//             console.log("No substeps container found in this step.");
//         }
//     });
// }


function traverseStepsAndSubsteps(parentContainer) {
    // 获取父容器中的所有步骤
    let steps = parentContainer.querySelectorAll('.step');
    console.log(steps);
    console.log(parentContainer);
    
    // 遍历每个步骤
    steps.forEach(step => {
        console.log("Inspecting step:", step);  // 可以在这里处理每个步骤

        // 在当前步骤中查找子步骤容器
        let subStepsContainer = step.querySelector('.substeps-container');

        // 检查是否找到子步骤容器
        if (subStepsContainer) {
            console.log("Found substeps container in step:", subStepsContainer);

            // 如果需要，可以在这里继续处理找到的子步骤容器
            adjustSubStepHeights(subStepsContainer);
            // 异步方式改变透明度以触发动画
            setTimeout(() => {
                traverseStepsAndSubsteps_substep(subStepsContainer);
            }, 400); // 微小延迟确保 DOM 已更新
            // 递归调用以遍历子步骤容器
            
        } else {
            console.log("No substeps container found in this step.");
        }
    });
}


function traverseStepsAndSubsteps_substep(parentContainer) {
    // 获取父容器中的所有步骤
    let steps = parentContainer.querySelectorAll('.substep');
    console.log(steps);
    console.log(parentContainer);
    
    // 遍历每个步骤
    steps.forEach(step => {
        console.log("Inspecting step:", step);  // 可以在这里处理每个步骤

        // 在当前步骤中查找子步骤容器
        let subStepsContainer = step.querySelector('.substeps-container');

        // 检查是否找到子步骤容器
        if (subStepsContainer) {
            console.log("Found substeps container in step:", subStepsContainer);

            // 如果需要，可以在这里继续处理找到的子步骤容器
            adjustSubStepHeights(subStepsContainer);

            // 异步方式改变透明度以触发动画
            setTimeout(() => {
                traverseStepsAndSubsteps_substep(subStepsContainer);
            }, 400); // 微小延迟确保 DOM 已更新
            // 递归调用以遍历子步骤容器
        } else {
            console.log("No substeps container found in this step.");
        }
    });
}




        function addEditableTextContainer(stepDiv, placeholderText) {
            var textDiv = document.createElement('textarea');
            textDiv.className = 'text-content';

            // 设置占位符内容
            textDiv.setAttribute('placeholder', 'Input Your Thoughts');




            stepDiv.appendChild(textDiv);

            // // 修正contenteditable不显示placeholder的问题
            // if (!textDiv.textContent.trim()) {
            //     textDiv.textContent = placeholderText;
            //     textDiv.style.color = 'rgba(0, 0, 0, 0.5)'; // 设置浅色字体
            //     textDiv.onfocus = function() {
            //         if (textDiv.textContent === placeholderText) {
            //             textDiv.textContent = '';
            //             textDiv.style.color = 'rgba(0, 0, 0, 1)'; // 恢复正常字体颜色
            //         }
            //     };
            //     textDiv.onblur = function() {
            //         if (!textDiv.textContent.trim()) {
            //             textDiv.textContent = placeholderText;
            //             textDiv.style.color = 'rgba(0, 0, 0, 0.5)';
            //         }
            //     };
            // }
        }

        function updateEditableTextContainer(stepDiv, additionalText) {
            var textDiv = stepDiv.querySelector('.text-content');
            textDiv.placeholder += '\n' + additionalText;  // 追加文本
        }







        // Function to parse line numbers and convert them into an array of integers
        function parseLineNumbers(lineNumber) {
            if (!lineNumber) return [];
            if (lineNumber.includes('[')) {
                // Assuming the format is like "[1, 2, 3]"
                return JSON.parse(lineNumber).map(n => n - 2); // Convert to zero-based index
            }
            else{
                return lineNumber.map(n => n - 2); // Convert to zero-based index
            }
        }

        // Function to highlight lines
        function highlightLines(lines) {
            lines.forEach(line => {
                if (line >= 0) editor.addLineClass(line+1, 'background', 'line-highlight');
            });
        }

        // Function to clear highlighted lines
        function clearHighlight(lines) {
            lines.forEach(line => {
                if (line >= 0) editor.removeLineClass(line+1, 'background', 'line-highlight');
            });
        }




        console.log(parseLineNumbers([10, 11, 12]));







        function addIconsAndHint(stepDiv, hint, step_json = {}) {
                      








            var magnifier = document.createElement('img');
            magnifier.src = 'idea.png';
            magnifier.className = 'magnifier';


            // 创建一个元素用于显示提示信息，初始时不显示
            var hintDiv = document.createElement('div');
            hintDiv.className = 'hint';
            hintDiv.style.display = 'none';  // 默认不显示提示
            hintDiv.style.position = 'absolute';
            hintDiv.style.width = '70%'; // 根据需求调整宽度
            hintDiv.style.height = 'auto'; // 自动高度
            hintDiv.style.backgroundColor = 'rgba(255, 255, 255, 0.99)'; // 半透明背景
            hintDiv.style.zIndex = '9999'; // 确保浮动在内容之上
            hintDiv.style.bottom = '0';
            hintDiv.style.left = '0';

            // 添加灯泡图标
            var lightBulbIcon = document.createElement('img');
            lightBulbIcon.src = 'idea.png'; // 确保正确的路径
            lightBulbIcon.alt = 'Hint';
            lightBulbIcon.style.position = 'absolute';
            lightBulbIcon.style.top = '5px';
            lightBulbIcon.style.left = '5px';
            lightBulbIcon.style.width = '20px'; // 根据需要调整大小
            lightBulbIcon.style.height = '20px'; // 根据需要调整大小
            hintDiv.appendChild(lightBulbIcon);

            // 添加提示文本
            var hintText = document.createElement('div');
            hintText.textContent = hint || 'No hint available for this step.';
            hintText.style.marginLeft = '30px'; // 文本右移以腾出图标位置
            hintText.style.padding = '5px';
            hintDiv.appendChild(hintText);

            // 添加按钮
            var yesButton = document.createElement('button');
            yesButton.textContent = 'Got it';
            yesButton.className = 'yes-button'; 
            yesButton.onclick = function() { hintDiv.style.display='none'; };

            console.log(step_json)
            console.log(Object.keys(step_json)[0])
            if (Object.keys(step_json).length === 0){
                hintDiv.appendChild(yesButton);
            }
            if (Object.keys(step_json).length != 0 && step_json[Object.keys(step_json)[0]].status.correctness == "correct"){
                hintDiv.appendChild(yesButton);
            }
            if (Object.keys(step_json).length != 0 && step_json[Object.keys(step_json)[0]].status.correctness != "correct"){
                var noButton = document.createElement('button');
                noButton.textContent = 'Reveal Key Subtep';
                noButton.className = 'no-button';
                noButton.onclick = function() {
                    console.log('Need more help clicked');

                    reveal_detailedHint(stepDiv, step_json);
                    hintDiv.removeChild(noButton);
                };

                hintDiv.appendChild(yesButton);
                hintDiv.appendChild(noButton);
            }
            // 如果是多个missing拼起来的，需要弄成可分的class
            if (Object.keys(step_json).length > 1){
                stepDiv.classList.add("can-be-divided");
            }



            // 点击放大镜图标显示提示信息
            magnifier.onclick = function() {
                // 切换提示信息的显示状态
                hintDiv.style.display = hintDiv.style.display === 'none' ? 'block' : 'none';    
                // 重新计算 hintDiv 的位置
                // if (hintDiv.style.display === 'block') {
                //     var rect = stepDiv.getBoundingClientRect();
                //     hintDiv.style.left = `${rect.left}px`;
                //     hintDiv.style.bottom = `${rect.bottom}px`;
                // }
        
        
            };

            // 在步骤块中添加放大镜
            stepDiv.appendChild(magnifier);
            

            stepDiv.appendChild(hintDiv); // Append the hint div to the step div
            // document.body.appendChild(hintDiv);

    
        }




        function addInitialEmptyBlock() {
            var container = document.getElementById('steps-container');

            var stepDiv = document.createElement('div');
            stepDiv.id = generateUUID();
            stepDiv.className = 'step';
            stepDiv.style.border = '1px solid #ccc';
            stepDiv.style.padding = '10px';
            stepDiv.style.margin = '10px 0';
            stepDiv.style.position = 'relative';

            // Adding magnifier button
            var magnifierButton = document.createElement('button');
            magnifierButton.innerHTML = '🔍';
            magnifierButton.style.position = 'absolute';
            magnifierButton.style.top = '5px';
            magnifierButton.style.right = '35px'; // Adjust position as necessary
            stepDiv.appendChild(magnifierButton);

            // Adding add (plus) button
            var addButton = document.createElement('button');
            addButton.innerHTML = '+';
            addButton.style.position = 'absolute';
            addButton.style.top = '5px';
            addButton.style.right = '5px'; // Adjust position as necessary
            stepDiv.appendChild(addButton);

            // Appending the empty step to the container
            container.appendChild(stepDiv);
            renumberSteps(container);
        }



        window.onload = function() {
            document.getElementById('language-selector').dispatchEvent(new Event('change'));
            // loadSteps(step2);
            // addInitialEmptyBlock();



            var container = document.getElementById('steps-container');


            
            
            




            var stepDiv = document.createElement('div');
            stepDiv.id = generateUUID();
            stepDiv.style.height = `95%`;
            stepDiv.className = `step missing`;
            stepDiv.style.display = 'flex';
            stepDiv.style.flexDirection = 'column'; // 确保内容和子步骤垂直排列



            // 创建新的 textarea 元素
            var textDiv = document.createElement('textarea');
            textDiv.className = 'text-content';

            // 设置占位符内容
            textDiv.setAttribute('placeholder', 'Input Your Thoughts');



            // var textDiv = document.createElement('div');
            // textDiv.className = 'text-content';
            // textDiv.setAttribute('contenteditable', 'true');
            // textDiv.textContent = "?";



            stepDiv.appendChild(textDiv);

            container.appendChild(stepDiv);
            renumberSteps(container);




            addIconsAndHint(stepDiv, "Try it!");  // 将图标和提示添加到步骤块中


            addSplitButton(stepDiv);
            addRemoveButton(stepDiv);
            addAddSubStepButton(stepDiv); // 添加C.png按钮


            document.querySelectorAll('.step').forEach((step, index) => {
                const stepData = stepsData_test.steps[index + 1];
                console.log(stepData)
                const linesToHighlight = parseLineNumbers(stepData.lineNumber);

                step.addEventListener('mouseenter', () => {
                    highlightLines(linesToHighlight);
                });

                step.addEventListener('mouseleave', () => {
                    clearHighlight(linesToHighlight);
                });


                
            });

            hiddenbydefault();
            
            
            // 在这里初始化按钮事件
            document.getElementById('ready-to-code-btn').addEventListener('click', function() {
                commentCopyBack();
            });
        };


        


        function commentCopyBack(){


            var problemDescription = document.getElementById('problem-description').innerText;

            var user_current_stepsData = saveToJson();

            var codeContent = editor.getValue();


            var requestData = {
                problemDescription: problemDescription,
                steps: user_current_stepsData,
                code: codeContent
            };


            call_gpt_commentCopyBack(requestData);
        }





        function call_gpt_commentCopyBack(data_to_send, retryCount = 0) {
            console.log('start sending!')

            var loadingElement = document.getElementById('loading');
            // loadingElement.classList.remove('hidden'); // 显示加载动画
            loadingElement.style.display = 'flex';




            console.log(data_to_send['problemDescription']);
            console.log(data_to_send['steps']);

            
            // 首先，向server发送问题，得到关于solution的相关信息
            $.ajax({
            url: common_prefix + "copyback",
            type: "GET",
            data: {
                "problem": String(data_to_send['problemDescription']), 
                "code_block": String(data_to_send['steps']),
                "code_editor": String(data_to_send['code'])
            }
            }).done(function (data) {
                // try {
                    console.log(data);




                    // 检查data是否已经是对象
                    var jsonData = (typeof data === "object") ? data : JSON.parse(data);
                    console.log("JSON Object:", jsonData);


                    // Validate the top-level steps
                    var valid_json = validateSteps_copyback(jsonData);
                    
                    // 如果发现json出现了异常的字段，重发请求
                    if (!valid_json) {
                        console.log("发现异常字段");
                        if (retryCount < 3) {  // 设置最大重试次数为3次
                            console.log(`Retrying... Attempt ${retryCount + 1}`);
                            call_gpt_commentCopyBack(data_to_send, retryCount + 1);
                            return;
                        } else {
                            console.error('Maximum retry attempts reached.');
                        }
                    }









                    loadingElement.style.display = 'none';



                    var codeContent = editor.getValue();

                    let updatedCode = insertComments(codeContent, jsonData);
                    console.log(updatedCode);

                    // Use this function to set the value of the editor
                    editor.setValue(updatedCode);



            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error('AJAX request failed:', textStatus, errorThrown);
                if (retryCount < 3) {  // 设置最大重试次数为3次
                    console.log(`Retrying... Attempt ${retryCount + 1}`);
                    call_gpt_commentCopyBack(data_to_send, retryCount + 1);
                } else {
                    console.error('Maximum retry attempts reached.');
                }
            });

            
        }
















        // Initialize a variable to hold the resulting integer value from the conversion.
        // Iterate over the Roman numeral string from right to left.
        // Check the value of the current numeral against the value of the numeral before it.
        // Apply addition or subtraction based on the comparison.




        var count = 0;


        function generateJson_fromEditor() {

            if (confirm("Continuing will overwrite the existing stepbox. Do you want to continue?")) {
                count += 1;


                var problemDescription = document.getElementById('problem-description').innerText;
                var codeContent = editor.getValue();
                var requestData = {
                    problemDescription: problemDescription,
                    code: codeContent
                };
                console.log(JSON.stringify(requestData));

                call_gpt_from_editor_1st(requestData);

                // if(count == 1){
                //     simulate_call_gpt(stepsData_test);
                // }
                // if(count == 2){
                //     simulate_call_gpt(demo_step2);
                // }
                // if(count == 3){
                //     simulate_call_gpt(demo_step3);
                // }
                // if(count == 4){
                //     simulate_call_gpt(demo_step4);
                // }
                // if(count == 5){
                //     simulate_call_gpt(demo_step5);
                // }
            }
           
            
        }



        var user_history_stepsData = [];

        function generateJson_fromBlock() {
            count += 1;
            
            var problemDescription = document.getElementById('problem-description').innerText;

            // var steps = document.querySelectorAll('.text-content');
            // var user_current_stepsData = { steps: {} }; // 创建JSON结构来保存步骤内容

            // steps.forEach((step, index) => {
            //     // Step number is based on index, as steps are usually ordered
            //     var inputText = step.textContent.trim();
            //     var userInput = inputText === "Type your thoughts" ? "" : inputText; // Save empty string if placeholder text

            //     user_current_stepsData.steps[index + 1] = { "student current input": userInput };
            // });



            var user_current_stepsData = saveToJson();

            var user_current_stepsData_withid = saveToJson_withid();
            console.log(user_current_stepsData);
            console.log(user_current_stepsData_withid);

            user_history_stepsData.push(user_current_stepsData_withid);

            var requestData = {
                problemDescription: problemDescription,
                steps: user_current_stepsData
            };


            

            // console.log(JSON.stringify(requestData)); // 在控制台打印JSON数据，也可以发送到服务器

            call_gpt_from_block(requestData);

            // if(count == 1){
            //     simulate_call_gpt(stepsData_test1);
            // }
            // if(count == 2){
            //     simulate_call_gpt(stepsData_test1);
            // }
            // if(count == 3){
            //     simulate_call_gpt(stepsData_test2);
            // }
            // if(count == 4){
            //     simulate_call_gpt(demo_step4);
            // }
            // if(count == 5){
            //     simulate_call_gpt(demo_step5);
            // }
        }










        function saveToJson() {
            const steps = document.querySelectorAll('.step');
            const data = {};

            function processStep(step) {
                const content = step.querySelector('.text-content').textContent.trim();
                const stepData = {
                    content: content === '?' ? '' : content,
                    substeps: {}
                };

                // const subStepsContainer = step.querySelector('.substeps-container');
                // 获取直接子节点中同时具有 'substeps-container' class 的元素

                // console.log(step)
                // console.log(step.children)
                const subStepsContainer = Array.from(step.children).find(child => child.classList.contains('substeps-container'));
                if (subStepsContainer) {
                    // const subSteps = Array.from(subStepsContainer.children).find(child => child.classList.contains('substep'));
                    const subSteps = Array.from(subStepsContainer.children).filter(child => child.classList.contains('substep'));

                    console.log(subSteps)
                    if (subSteps){
                        subSteps.forEach((subStep, subIndex) => {
                            const subStepKey = `substep${subIndex + 1}`;
                            stepData.substeps[subStepKey] = processStep(subStep);
                        });
                    }

                }

                return stepData;
            }

            steps.forEach((step, index) => {
                const stepKey = `step${index + 1}`;
                data[stepKey] = processStep(step);
            });

            const jsonResult = JSON.stringify(data, null, 2);
            console.log(jsonResult);

            return jsonResult;
        }


        function saveToJson_withid() {

            const steps = document.querySelectorAll('.step');
            const data = {};

            function processStep(step) {
                const content = step.querySelector('.text-content').textContent.trim();
                const stepData = {
                    id: step.id || '',
                    status: step.className || '',
                    content: content === '?' ? '' : content,
                    substeps: {}
                };

                // const subStepsContainer = step.querySelector('.substeps-container');
                // 获取直接子节点中同时具有 'substeps-container' class 的元素

                console.log(step)
                console.log(step.children)
                const subStepsContainer = Array.from(step.children).find(child => child.classList.contains('substeps-container'));
                if (subStepsContainer) {
                    // const subSteps = Array.from(subStepsContainer.children).find(child => child.classList.contains('substep'));
                    const subSteps = Array.from(subStepsContainer.children).filter(child => child.classList.contains('substep'));

                    console.log(subSteps)
                    if (subSteps){
                        subSteps.forEach((subStep, subIndex) => {
                            const subStepKey = `substep${subIndex + 1}`;
                            stepData.substeps[subStepKey] = processStep(subStep);
                        });
                    }

                }

                return stepData;
            }

            steps.forEach((step, index) => {
                const stepKey = `step${index + 1}`;
                data[stepKey] = processStep(step);
            });

            const jsonResult = JSON.stringify(data, null, 2);
            console.log(jsonResult);

            return data;
        }




        // function saveToJson() {
        //     const steps = document.querySelectorAll('.step');
        //     const data = {};

        //     steps.forEach((step, index) => {
        //         const stepKey = `step${index + 1}`;
        //         const stepContent = step.querySelector('.text-content').textContent.trim();
        //         data[stepKey] = {
        //             content: stepContent === '?' ? '' : stepContent,
        //             substeps: {}
        //         };

        //         const subStepsContainer = step.querySelector('.substeps-container');
        //         if (subStepsContainer) {
        //             const subSteps = subStepsContainer.querySelectorAll('.substep');
        //             subSteps.forEach((subStep, subIndex) => {
        //                 const subStepKey = `substep${index + 1}.${subIndex + 1}`;
        //                 const subStepContent = subStep.querySelector('.text-content').textContent.trim();
        //                 data[stepKey].substeps[subStepKey] = {
        //                     content: subStepContent === '?' ? '' : subStepContent
        //                 };
        //             });
        //         }
        //     });

        //     console.log(JSON.stringify(data, null, 2));

        //     return JSON.stringify(data, null, 2);
        // }





        // function saveToJson_withid() {
        //     const steps = document.querySelectorAll('.step');
        //     const data = {};

        //     steps.forEach((step, index) => {
        //         const stepKey = `step${index + 1}`;
        //         const stepContent = step.querySelector('.text-content').textContent.trim();
        //         data[stepKey] = {
        //             id: step.id || '',
        //             status: step.className || '',
        //             content: stepContent === '?' ? '' : stepContent,
        //             substeps: {}
        //         };

        //         const subStepsContainer = step.querySelector('.substeps-container');
        //         if (subStepsContainer) {
        //             const subSteps = subStepsContainer.querySelectorAll('.substep');
        //             subSteps.forEach((subStep, subIndex) => {
        //                 const subStepKey = `substep${index + 1}.${subIndex + 1}`;
        //                 const subStepContent = subStep.querySelector('.text-content').textContent.trim();
        //                 data[stepKey].substeps[subStepKey] = {
        //                     id: subStep.id || '',
        //                     status: subStep.className || '',
        //                     content: subStepContent === '?' ? '' : subStepContent
        //                 };
        //             });
        //         }
        //     });

        //     console.log(JSON.stringify(data, null, 2));

        //     // return JSON.stringify(data, null, 2);
        //     return data;
        // }


















        function simulate_call_gpt(data_to_send) {
            console.log('start sending!')



            var loadingElement = document.getElementById('loading');
            // loadingElement.classList.remove('hidden'); // 显示加载动画
            loadingElement.style.display = 'flex';

            // 假设这是一个异步操作，比如 AJAX 请求
            setTimeout(function() {




                



                loadSteps_fromBlock(studentJson);

                


                // loadSteps(data_to_send); // 加载步骤数据到右侧区域
                
                
                // loadingElement.classList.add('hidden'); // 隐藏加载动画
                loadingElement.style.display = 'none';
                // 在这里处理加载完成后的操作

                console.log(data_to_send)

                console.log(document.querySelectorAll('.step'))

                document.querySelectorAll('.step').forEach((step, index) => {
                    const stepData = data_to_send.steps[index + 1];
                    console.log(stepData)
                    const linesToHighlight = parseLineNumbers(stepData.lineNumber);

                    step.addEventListener('mouseenter', () => {
                        highlightLines(linesToHighlight);
                    });

                    step.addEventListener('mouseleave', () => {
                        clearHighlight(linesToHighlight);
                    });
                });

                hiddenbydefault();
            }, 2000); // 假设加载需要3秒钟




           
        }





        function call_gpt_from_editor_1st(data_to_send, retryCount = 0) {
            console.log('start sending!')

            editmode_on = false;

            var loadingElement = document.getElementById('loading');
            // loadingElement.classList.remove('hidden'); // 显示加载动画
            loadingElement.style.display = 'flex';

            // 假设这是一个异步操作，比如 AJAX 请求
            // setTimeout(function() {
            //     loadingElement.classList.add('hidden'); // 隐藏加载动画
            //     // 在这里处理加载完成后的操作
            // }, 3000); // 假设加载需要3秒钟





            console.log(data_to_send['problemDescription']);
            console.log(data_to_send['code']);

            if (data_to_send['code'] == ''){
                data_to_send['code'] = 'def';
            }

            console.log(data_to_send['code']);
            
            // 首先，向server发送问题，得到关于solution的相关信息
            $.ajax({
            url: common_prefix + "from_editor_firstcall",
            type: "GET",
            data: {
                "problem": String(data_to_send['problemDescription']), 
                "code_editor": String(data_to_send['code'])
            }
            }).done(function (data) {
                // try {
                    console.log(data);




                    // 检查data是否已经是对象
                    var jsonData = (typeof data === "object") ? data : JSON.parse(data);
                    console.log("JSON Object:", jsonData);
                    stepsData = jsonData;





                    // Validate the top-level steps
                    var valid_json = validateSteps_firstfromeditor(jsonData);
                    
                    // 如果发现json出现了异常的字段，重发请求
                    if (!valid_json) {
                        console.log("发现异常字段");
                        if (retryCount < 3) {  // 设置最大重试次数为3次
                            console.log(`Retrying... Attempt ${retryCount + 1}`);
                            call_gpt_from_editor_1st(data_to_send, retryCount + 1);
                            return;
                        } else {
                            console.error('Maximum retry attempts reached.');
                        }
                    }








                    loadSteps(stepsData); // 加载步骤数据到右侧区域




                    document.querySelectorAll('.step').forEach((step, index) => {
                        const stepData = stepsData.steps[index + 1];
                        console.log(stepData);

                        const linesToHighlight = parseLineNumbers(stepData.lineNumber);
                        // const linesToHighlight = stepData.lineNumber;

                        console.log(linesToHighlight);

                        step.addEventListener('mouseenter', () => {
                            highlightLines(linesToHighlight);
                        });

                        step.addEventListener('mouseleave', () => {
                            clearHighlight(linesToHighlight);
                        });
                    });



                    


                    loadingElement.style.display = 'none';
                    // 在这里处理加载完成后的操作


                    closeEditMode();

                    hiddenbydefault();


                // }
                // catch (error) {
                //     console.error('Error processing response:', error);
                // }
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error('AJAX request failed:', textStatus, errorThrown);
                if (retryCount < 3) {  // 设置最大重试次数为3次
                    console.log(`Retrying... Attempt ${retryCount + 1}`);
                    call_gpt_from_editor_1st(data_to_send, retryCount + 1);
                } else {
                    console.error('Maximum retry attempts reached.');
                }
            });

            
        }









        function call_gpt_from_block(data_to_send, retryCount = 0) {
            console.log('start sending!')

            var loadingElement = document.getElementById('loading');
            // loadingElement.classList.remove('hidden'); // 显示加载动画
            loadingElement.style.display = 'flex';

            // 假设这是一个异步操作，比如 AJAX 请求
            // setTimeout(function() {
            //     loadingElement.classList.add('hidden'); // 隐藏加载动画
            //     // 在这里处理加载完成后的操作
            // }, 3000); // 假设加载需要3秒钟





            console.log(data_to_send['problemDescription']);
            console.log(data_to_send['steps']);

            
            // 首先，向server发送问题，得到关于solution的相关信息
            $.ajax({
            url: common_prefix + "from_block",
            type: "GET",
            data: {
                "problem": String(data_to_send['problemDescription']), 
                "code_block": String(data_to_send['steps'])
            }
            }).done(function (data) {
                // try {
                    console.log(data);




                    // 检查data是否已经是对象
                    var jsonData = (typeof data === "object") ? data : JSON.parse(data);
                    console.log("JSON Object:", jsonData);


                    // Validate the top-level steps
                    var valid_json = validateSteps_fromBlock(jsonData);
                    
                    // 如果发现json出现了异常的字段，重发请求
                    if (!valid_json) {
                        console.log("发现异常字段");
                        if (retryCount < 3) {  // 设置最大重试次数为3次
                            console.log(`Retrying... Attempt ${retryCount + 1}`);
                            call_gpt_from_block(data_to_send, retryCount + 1);
                            return;
                        } else {
                            console.error('Maximum retry attempts reached.');
                        }
                    }


                    loadingElement.style.display = 'none';

                    // loadSteps(stepsData); // 加载步骤数据到右侧区域


                    console.log(user_history_stepsData[user_history_stepsData.length - 1])
                    // 先给GPT返回的json加入id字段
                    var student_json = matchAndAssignIds(user_history_stepsData[user_history_stepsData.length - 1], jsonData);

                    console.log(student_json)


                    loadSteps_fromBlock(student_json);



                        closeEditMode();

                        hiddenbydefault();

                // }
                // catch (error) {
                //     console.error('Error processing response:', error);
                // }
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error('AJAX request failed:', textStatus, errorThrown);
                if (retryCount < 3) {  // 设置最大重试次数为3次
                    console.log(`Retrying... Attempt ${retryCount + 1}`);
                    call_gpt_from_block(data_to_send, retryCount + 1);
                } else {
                    console.error('Maximum retry attempts reached.');
                }
            });

            
        }


        var stepsWithoutCode = [];
        var codeWithoutSteps = [];
        var current_statusofthebox = [];

        function call_gpt_check_mapping(data_to_send, retryCount = 0){
            
            console.log('start sending!')

            var loadingElement = document.getElementById('loading');
            // loadingElement.classList.remove('hidden'); // 显示加载动画
            loadingElement.style.display = 'flex';




            console.log(data_to_send['problemDescription']);
            console.log(data_to_send['steps']);

            
            // 首先，向server发送问题，得到关于solution的相关信息
            $.ajax({
            url: common_prefix + "check_mapping",
            type: "GET",
            data: {
                "problem": String(data_to_send['problemDescription']), 
                "code_block": String(data_to_send['steps']),
                "code_editor": String(data_to_send['code'])
            }
            }).done(function (data) {
                // try {
                    console.log(data);




                    // 检查data是否已经是对象
                    var jsonData = (typeof data === "object") ? data : JSON.parse(data);
                    console.log("JSON Object:", jsonData);

                    // Validate the top-level steps
                    var valid_json = validateSteps_checkmapping(jsonData);
                    
                    // 如果发现json出现了异常的字段，重发请求
                    if (!valid_json) {
                        console.log("发现异常字段");
                        if (retryCount < 3) {  // 设置最大重试次数为3次
                            console.log(`Retrying... Attempt ${retryCount + 1}`);
                            call_gpt_check_mapping(data_to_send, retryCount + 1);
                            return;
                        } else {
                            console.error('Maximum retry attempts reached.');
                        }
                    }





                    current_statusofthebox = [];

                    loadingElement.style.display = 'none';


                    // Parse the JSON object
                    stepsWithoutCode = jsonData["step or substeps that do not have corresponding code"];
                    codeWithoutSteps = jsonData["code lines that do not have corresponding step or substep"];

                    // Highlight code lines that do not have corresponding step or substep
                    codeWithoutSteps.forEach(function(line) {
                        // editor.addLineClass(line, 'background', 'line-highlight');
                        addErrorMarker(line);
                    });

                    // Highlight steps or substeps that do not have corresponding code
                    var container = document.getElementById('steps-container');



                    const steps = document.querySelectorAll('.step');


                    count = 1;
                    steps.forEach(element => {
                        if(!stepsWithoutCode.includes(count)){
                            element.className = "step mapped";
                        }
                    });


                    stepsWithoutCode.forEach(function(step) {
                        console.log(container.childNodes[step-1].className);
                        current_statusofthebox.push(container.childNodes[step-1].className);
                        // container.childNodes[step-1].className = "step_highlight";
                        container.childNodes[step-1].className = "step unmapped";
                    });






                    document.getElementById('output').innerHTML = "<p>The highlighted code line in the editor cannot find the corresponding step in the step box.</p><p>The highlighted box in the step box cannot find the corresponding code line in the editor.</p><button class='button' onclick='ok_isee()' id='okButton'>I See</button>";

            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error('AJAX request failed:', textStatus, errorThrown);
                if (retryCount < 3) {  // 设置最大重试次数为3次
                    console.log(`Retrying... Attempt ${retryCount + 1}`);
                    call_gpt_check_mapping(data_to_send, retryCount + 1);
                } else {
                    console.error('Maximum retry attempts reached.');
                }
            });
        }




        // Run Code

        var errorOccured = false;

        var testCases = [
            {input: "III", targetOutput: "3"},
            {input: "LVIII", targetOutput: "58"},
            {input: "MCMXCIV", targetOutput: "1994"},
        ];


        var function_header = "romanToInt";

        for (let i = 0; i < testCases.length; i++) {
            const input = testCases[i].input;
            const targetOutput = testCases[i].targetOutput;


            document.getElementById(`input-${i + 1}`).innerText = input;
            document.getElementById(`target-output-${i + 1}`).innerText = targetOutput;
        }




        function runTestCases() {
            passCount = 0;
            for (let i = 0; i < testCases.length; i++) {
                const input = testCases[i].input;
                const targetOutput = testCases[i].targetOutput;
                const yourOutput = runCode(input); // Replace this with your actual function

                document.getElementById(`input-${i + 1}`).innerText = input;
                document.getElementById(`target-output-${i + 1}`).innerText = targetOutput;
                document.getElementById(`your-output-${i + 1}`).innerText = yourOutput;

                const correctness = (yourOutput === targetOutput) ? 'Correct' : 'Incorrect';
                const correctnessElement = document.getElementById(`correctness-${i + 1}`);
                correctnessElement.innerText = correctness;
                correctnessElement.className = (yourOutput === targetOutput) ? 'correct' : 'incorrect';

                if(correctness == "Correct"){
                    passCount += 1;
                }
            }
            if (passCount >= 2){
                document.getElementById('output').className = 'correct-text';
                document.getElementById('output').textContent = 'Accepted';
            }
            if (passCount < 2 && errorOccured == false){
                document.getElementById('output').className = 'error-text';
                document.getElementById('output').textContent = 'Wrong Answer';
            }
        }














        function parseString(input) {
            // 匹配形式 a = b, c = d 的字符串
            var regex = /(\w+)\s*=\s*(\[.*?\]|\d+|\w+),\s*(\w+)\s*=\s*(\[.*?\]|\d+|\w+)/;
            var match = input.match(regex);

            if (match) {
                var b = parseValue(match[2].trim());
                var d = parseValue(match[4].trim());

                return [b, d];
            } else {
                throw new Error("输入字符串格式不正确");
            }
        }

        function parseValue(value) {
            // 尝试将值转换为数组
            if (value.startsWith('[') && value.endsWith(']')) {
                try {
                    return JSON.parse(value);
                } catch (e) {
                    throw new Error("数组解析失败: " + value);
                }
            }

            // 尝试将值转换为数字
            var parsedNumber = parseFloat(value);
            if (!isNaN(parsedNumber)) {
                return parsedNumber;
            }

            // 如果无法转换为数组或数字，则返回原始字符串
            return value;
        }


        function runCode(input) {
            console.log(input);
            // let pyCode = document.getElementById('code').value;
            let pyCode = editor.getValue(); // 使用 getValue 方法而不是 textarea 的 value
            if (input.includes('=')) {
                console.log("字符串包含等号");
                // 先对input进行拆分
                var inputarr = parseString(input);
                console.log(inputarr);
                pyCode = pyCode + '\n' + function_header + '(' + JSON.stringify(inputarr[0]) + ', ' + JSON.stringify(inputarr[1]) + ')';       
            } else {
                console.log("字符串不包含等号");
                console.log(input)
                if (!isNaN(input) && Number.isInteger(Number(input))) {
                    // 输入是整数
                    pyCode = pyCode + '\n' + function_header + '(' + input + ')';
                } else if (typeof input === 'boolean') {
                    // 输入是布尔值
                    pyCode = pyCode + '\n' + function_header + '(' + input + ')';
                } else if (input.startsWith('[') && input.endsWith(']')) {
                    // 输入是数组
                    try {
                        pyCode = pyCode + '\n' + function_header + '(' + input + ')';
                    } catch (e) {
                        throw new Error("数组解析失败: " + input);
                    }
                } else {
                    // 默认情况，将输入转换为字符串
                    pyCode = pyCode + '\n' + function_header + '(' + JSON.stringify(input) + ')';
                }





                // if (input.startsWith('[') && input.endsWith(']')) {
                //     try {
                //         console.log("是数组");
                //         pyCode = pyCode + '\n' + function_header + '(' + input + ')';
                //     } catch (e) {
                //         throw new Error("数组解析失败: " + value);
                //     }
                // }
                // else{
                //     console.log("不是数组");
                //     pyCode = pyCode + '\n' + function_header + '(' + JSON.stringify(input) + ')';
                // }


            }

            
            console.log(pyCode);
            try {
                let results = pyodide.runPython(pyCode);
                errorOccured = false;
                console.log(results)
                return results.toString();
            } catch (error) {
                errorOccured = true;
                document.getElementById('output').className = 'error-text';
                if (error.message == "Cannot read properties of undefined (reading 'toString')"){
                    document.getElementById('output').textContent = 'Error: The function is incomplete!';
                }
                else{
                    document.getElementById('output').textContent = 'Error: ' + error.message;
                }
                
            }
        }




        async function loadPyodideAndRun() {
            // Ensure to pass indexURL to loadPyodide pointing to the version directory
            window.pyodide = await loadPyodide({
                indexURL : "https://cdn.jsdelivr.net/pyodide/v0.21.3/full/"
            });
        }

        loadPyodideAndRun();

        function runPython() {
            // let pyCode = document.getElementById('code').value;
            let pyCode = editor.getValue(); // 使用 getValue 方法而不是 textarea 的 value
            pyCode = pyCode + '\n' + 'romanToInt("LVIII")';
            console.log(pyCode);
            try {
                let results = pyodide.runPython(pyCode);
                console.log(results);
                if (results.toString() == '58'){
                    document.getElementById('output').className = 'correct-text';
                    document.getElementById('output').textContent = 'Accepted';
                }
                else{
                    document.getElementById('output').className = 'error-text';
                    document.getElementById('output').textContent = 'Wrong Answer';
                }
            } catch (error) {
                document.getElementById('output').className = 'error-text';
                document.getElementById('output').textContent = 'Error: ' + error.message;
            }




            // let results = pyodide.runPython(`
            //     import sys
            //     sys.version
            //     `);
            // document.getElementById('output').textContent = results.toString();
        }


        function checkRelevance_simulate() {
            editor.addLineClass(11, 'background', 'line-highlight');
            editor.addLineClass(12, 'background', 'line-highlight');

            var container = document.getElementById('steps-container');
            console.log(container.childNodes);
            container.childNodes[3].className = "step_highlight";

            document.getElementById('output').innerHTML = "<p>The highlighted code line in the editor cannot find the corresponding step in the step box.</p><br><p>The highlighted box in the step box cannot find the corresponding code line in the editor.</p><button class='button' onclick='ok_isee()' id='okButton'>I See</button>";
        }


        function checkRelevance(data_to_send) {


            var problemDescription = document.getElementById('problem-description').innerText;

            var user_current_stepsData = saveToJson();

            var codeContent = editor.getValue();


            var requestData = {
                problemDescription: problemDescription,
                steps: user_current_stepsData,
                code: codeContent
            };



            call_gpt_check_mapping(requestData);


        }

        function ok_isee() {


            // Highlight code lines that do not have corresponding step or substep
            codeWithoutSteps.forEach(function(line) {
                // editor.removeLineClass(line, 'background', 'line-highlight');
                removeErrorMarker(line); 
            });

            // Highlight steps or substeps that do not have corresponding code
            var container = document.getElementById('steps-container');

            var count = 0;
            stepsWithoutCode.forEach(function(step) {
                container.childNodes[step-1].className = current_statusofthebox[count];
                count += 1;
            });

            document.getElementById('output').innerHTML = "";
        }













































        const originalJson = {
  "step1": {
    "id": "5ed28a5b-1f1a-4fe4-8aaf-ea213a525f40",
    "status": "step correct",
    "content": "Create a mapping from Roman numeral characters to their integer values.",
    "substeps": {
      "substep1.1": {
        "id": "22a2abad-e0e3-4e8d-9f6b-38e21a88cc97",
        "status": "substep missing can-be-divided",
        "content": "Check if the current numeral is not the last one in the string."
      },
      "substep1.2": {
        "id": "b066491c-8271-410c-b3fb-6f76b59abb7c",
        "status": "substep incorrect",
        "content": "Test if the numeral's value is less than the value of the next numeral."
      },
      "substep1.3": {
        "id": "e1a34a87-c94a-4603-8f63-7aab98cf7821",
        "status": "substep correct",
        "content": "Apply subtraction when needed and addition otherwise."
      }
    }
  },
  "step2": {
    "id": "83c73884-9e57-4c03-a4d0-7b592e60e49c",
    "status": "step incorrect",
    "content": "",
    "substeps": {}
  },
  "step3": {
    "id": "3b9a0c79-1c6d-4542-a6f2-911c777377ef",
    "status": "step missing can-be-divided",
    "content": "Initialize a variable to hold the resulting integer value from the conversion.",
    "substeps": {}
  }
};

const studentJson = {
  "steps": {
    "1": {
      "description": "Create a dictionary to map Roman numerals to their integer values.",
      "status": {
        "correctness": "correct",
        "can be further divided": "can"
      },
      "hint": "Define a data structure that pairs Roman numeral characters with their corresponding integer values.",
      "student current input": "Create a mapping from Roman numeral characters to their integer values.",
      "subSteps": {
        "1.1": {
          "description": "I is paired with 1.",
          "status": {
            "correctness": "correct",
            "can be further divided": "cannot"
          },
          "student current input": "Check if the current numeral is not the last one in the string."
        },
        "1.2": {
          "description": "V is paired with 5.",
          "status": {
            "correctness": "correct",
            "can be further divided": "cannot"
          },
          "student current input": "Test if the numeral's value is less than the value of the next numeral."
        },
        "1.3": {
          "description": "X is paired with 10.",
          "status": {
            "correctness": "correct",
            "can be further divided": "cannot"
          },
          "student current input": "Apply subtraction when needed and addition otherwise."
        },
        "1.4": {
          "description": "L is paired with 50.",
          "status": {
            "correctness": "correct",
            "can be further divided": "cannot"
          },
          "student current input": ""
        }
      }
    },
    "2": {
      "description": "Initialize an integer variable to hold the cumulative value.",
      "status": {
        "correctness": "incorrect",
        "can be further divided": "cannot"
      },
      "hint": "Start by assigning zero to a variable that will represent the total value computed from the Roman numeral.",
      "student current input": "Initialize a variable to hold the resulting integer value from the conversion.",
      "subSteps": {
        "1.1": {
          "description": "I is paired with 1.",
          "status": {
            "correctness": "correct",
            "can be further divided": "cannot"
          },
          "student current input": "Check if the current numeral is not the last one in the string."
        },
        "1.2": {
          "description": "V is paired with 5.",
          "status": {
            "correctness": "correct",
            "can be further divided": "cannot"
          },
          "student current input": "Test if the numeral's value is less than the value of the next numeral."
        }
      }
    },
    "3": {
      "description": "Iterate over the string of Roman numerals from left to right.",
      "status": {
        "correctness": "missing",
        "can be further divided": "can"
      },
      "hint": "Use a loop to examine each character in the Roman numeral string one by one.",
      "student current input": "",
      "subSteps": {
        "3.1": {
          "description": "Check if the current numeral is not the last one in the string.",
          "status": {
            "correctness": "correct",
            "can be further divided": "cannot"
          },
          "hint": "Ensure the next numeral exists before comparing its value with the current one.",
          "student current input": ""
        },
        "3.2": {
          "description": "Compare the value of the current numeral to the next numeral.",
          "status": {
            "correctness": "correct",
            "can be further divided": "cannot"
          },
          "hint": "Determine if the current numeral is smaller than the subsequent numeral to decide if subtraction is necessary.",
          "student current input": ""
        },
        "3.3": {
          "description": "Apply subtraction when the current numeral is smaller than the next, otherwise add the numeral's value.",
          "status": {
            "correctness": "correct",
            "can be further divided": "cannot"
          },
          "hint": "Subtract the current numeral's value from the total when it precedes a larger numeral; add it when it does not.",
          "student current input": ""
        },
        "3.4": {
          "description": "Move to the next numeral to continue the process.",
          "status": {
            "correctness": "missing",
            "can be further divided": "cannot"
          },
          "hint": "Update the position within the string to process the next numeral, skipping over the numeral used in any subtraction.",
          "student current input": ""
        }
      }
    },
    "4": {
      "description": "Return the computed integer as the conversion result.",
      "status": {
        "correctness": "missing",
        "can be further divided": "cannot"
      },
      "hint": "After completing the loop, provide the final integer value representing the Roman numeral.",
      "student current input": ""
    }
  }
};

function updateJsonStatuses(original, student) {
    // Iterate over each step in the student JSON
    for (let stepNum in student.steps) {
        let studentStep = student.steps[stepNum];
        let originalStepKey = `step${stepNum}`;
        
        // Check if the step exists in the original JSON
        if (original[originalStepKey]) {
            // If the student input matches the original content, update the status
            if (studentStep['student current input'] === original[originalStepKey].content) {
                original[originalStepKey].status = studentStep.status.correctness;
                
                // Iterate over each substep in the student JSON
                if (studentStep.subSteps) {
                    for (let subStepNum in studentStep.subSteps) {
                        let studentSubStep = studentStep.subSteps[subStepNum];
                        let originalSubStepKey = `substep${stepNum}.${subStepNum}`;
                        
                        // Check if the substep exists in the original JSON
                        if (original[originalStepKey].substeps[originalSubStepKey]) {
                            // Update the status if the substep content matches
                            if (studentSubStep.description === original[originalStepKey].substeps[originalSubStepKey].content) {
                                original[originalStepKey].substeps[originalSubStepKey].status = studentSubStep.status.correctness;
                            }
                        }
                    }
                }
            }
        }
    }
}

// updateJsonStatuses(originalJson, studentJson);

// console.log(JSON.stringify(originalJson, null, 2));



// 下面是两个json，写一个代码，根据第一个json中的content，和第二个json中的student current input，
// 对两个json进行匹配。如果能够匹配的上，就对第二个json中，能够与第一个json匹配的上的step或者substep添加id为第一个json中的step或者substep。
// 如果匹配不上，也添加一个id字段，但是id是通过generateUUID()生成的。


function addIdsAndMatchSteps(original, student) {
    // Iterate over each step in the student JSON
    for (let stepNum in student.steps) {
        let studentStep = student.steps[stepNum];
        let originalStepKey = `step${stepNum}`;
        
        // Check if the step content matches
        if (original[originalStepKey] && studentStep['student current input'] === original[originalStepKey].content) {
            studentStep.id = original[originalStepKey].id;
        } else {
            studentStep.id = generateUUID();
        }

        // Iterate over each substep in the student JSON
        if (studentStep.subSteps) {
            for (let subStepNum in studentStep.subSteps) {
                let studentSubStep = studentStep.subSteps[subStepNum];
                // let originalSubStepKey = `substep${stepNum}.${subStepNum}`;
                let originalSubStepKey = `substep${subStepNum}`;
                
                // Check if the substep content matches
                if (original[originalStepKey] && original[originalStepKey].substeps[originalSubStepKey] &&
                    studentSubStep['student current input'] === original[originalStepKey].substeps[originalSubStepKey].content) {
                    studentSubStep.id = original[originalStepKey].substeps[originalSubStepKey].id;
                } else {
                    studentSubStep.id = generateUUID();
                }
            }
        }
    }

    return JSON.stringify(studentJson, null, 2);
}






function matchAndAssignIds(originalJson, studentJson) {
    // 遍历 studentJson 的 steps


    Object.values(studentJson.steps).forEach(studentStep => {
        let matched = false;
        let originalStep = null;
        
        // 查找 originalJson 中 content 匹配的 step
        for (let key in originalJson) {
            console.log(key)
            let step = originalJson[key];

            console.log(step)

            console.log(studentStep)
            if (step.content === studentStep['student current input']) {
                studentStep.id = step.id; // 赋值 ID
                matched = true;
                originalStep = step; // 保存匹配的 original step
                break;
            }
        }
        
        if (!matched) {
            studentStep.id = generateUUID(); // 不匹配时生成新的 UUID
        }

        // 遍历 studentStep 的 subSteps
        if (studentStep.subSteps) {
            Object.values(studentStep.subSteps).forEach(studentSubStep => {
                let subMatched = false;
                if (matched && originalStep && originalStep.substeps) {
                    // 如果 step 已匹配，查找其 substeps
                    for (let subKey in originalStep.substeps) {
                        let originalSubStep = originalStep.substeps[subKey];
                        if (originalSubStep.content === studentSubStep['student current input']) {
                            studentSubStep.id = originalSubStep.id; // 赋值 ID
                            subMatched = true;
                            break;
                        }
                    }
                }
                
                if (!subMatched) {
                    studentSubStep.id = generateUUID(); // 不匹配时生成新的 UUID
                }
            });
        }
    });

    console.log(studentJson)
    return studentJson;
    // return JSON.stringify(studentJson, null, 2);
}















    function toggleButtons(element, show) {
        // const buttons = element.querySelectorAll('.split-button, .remove-button, .add-substep-button, .magnifier');

        // console.log(element.children);
        const buttons = Array.from(element.children).filter(child => 
            child.classList.contains('split-button') ||
            child.classList.contains('remove-button') ||
            child.classList.contains('add-substep-button') ||
            child.classList.contains('magnifier')
        );

        // console.log(buttons)

        buttons.forEach(button => {
            button.style.display = show ? 'block' : 'none';
        });
    }


    function hiddenbydefault(){

        console.log(editmode_on);
        if (editmode_on == true){
            setTimeout(() => {



            const steps = document.querySelectorAll('.step, .substep');
            // console.log(`Found ${steps.length} steps.`);

            steps.forEach(element => {
                // console.log('Element found:', element);
                toggleButtons(element, false);

                element.addEventListener('mouseenter', () => {
                    toggleButtons(element, true);
                });

                element.addEventListener('mouseleave', () => {
                    toggleButtons(element, false);
                });

            });




            }, 500);
        }
        else{

            setTimeout(() => {
                const steps = document.querySelectorAll('.step, .substep');

                steps.forEach(element => {
                    toggleButtons(element, false);
                });
            }, 500);
        }

    }






        document.addEventListener('DOMContentLoaded', () => {

            
            console.log('DOM fully loaded and parsed');
            hiddenbydefault();


            setTimeout(() => {
                closeEditMode();
            }, 500);
        });



        var editmode_on = false;

        function openEditMode() {
            document.getElementById("openedit-btn").style.display = "none";
            document.getElementById("verify-btn").style.display = "block";
            const elements = document.querySelectorAll('.text-content');
            elements.forEach(element => {
                // element.contentEditable = 'true';
                element.removeAttribute('readonly');
            });

            editmode_on = true;

            hiddenbydefault();
        }



        function closeEditMode() {
            document.getElementById("openedit-btn").style.display = "block";
            document.getElementById("verify-btn").style.display = "none";
            const elements = document.querySelectorAll('.text-content');
            elements.forEach(element => {
                // element.contentEditable = 'false';
                element.setAttribute('readonly', true);
            });


            editmode_on = false;

            const steps = document.querySelectorAll('.step, .substep');

            steps.forEach(element => {
                toggleButtons(element, false);
            });


        }
























        function insertComments(code, steps) {
            let codeLines = code.split('\n');
            let nextInsertIndex = codeLines.length; // 初始值为代码的末尾

            for (let stepKey in steps) {
                let step = steps[stepKey];
                let content = step.content;
                
                if (step.lineNumber.length > 0) {
                    let firstLineNumber = step.lineNumber[0] - 1;
                    let indentation = codeLines[firstLineNumber].match(/^\s*/)[0];
                    codeLines[firstLineNumber] = `${indentation}# ${content}\n` + codeLines[firstLineNumber];
                } else {
                    // 将内容添加到nextInsertIndex位置，并更新nextInsertIndex
                    codeLines.splice(nextInsertIndex, 0, `# ${content}`);
                    nextInsertIndex++;
                }
            }
            return codeLines.join('\n');
        }








        function reveal_detailedHint(stepDiv, step_json){

            // 首先要找到界面中这个hint icon或者说Need More Help按钮所属的stepDiv与stepjson中的step的对应关系
            // 1. 得到某一个按钮的parent stepDiv的id
            // 2. 在stepjson中我们也有一个id
            // 这样做似乎有点麻烦，其实有更简单的办法，就是直接把step也作为addIconandHint的参数传入进来，如果是多个missing的，就把step拼接起来传进来。单独处理。



            console.log(step_json);

            // 凡是进入这个函数了，说明要么是错误的要么是missing的，就看是否多个missing合并的，或者是否有子步骤




            // 如果包含超过一个内容，说明是合并起来的，拆解为与当前stepDiv同级的div，添加到stepContainer中
            if (Object.keys(step_json).length > 1){


                // 先得到step-container
                var stepContainer = stepDiv.parentNode;

                var toinsert = [];

                // 遍历step_json，不断添加新的stepDiv
                Object.entries(step_json).forEach(([subStepId, subStep], index, array) => {
                    var newStepDiv = document.createElement('div');

                    newStepDiv.style.flexDirection = 'column'; // 确保内容和子步骤垂直排列


                    newStepDiv.id = generateUUID();

                    if (index === array.length - 1){
                        newStepDiv.className = `step systemgiven`;
                    }
                    else{
                        newStepDiv.className = `step missing`;
                    }
                    
                    newStepDiv.innerHTML = `
                        <textarea class='text-content' placeholder='Input Your Thoughts'>${index === array.length - 1 ? subStep.correctStep : ''}</textarea>
                    `;



                        


                    // 不应该往最后append，而是应该insert
                    addIconsAndHint(newStepDiv, subStep.hint);
                    addSplitButton(newStepDiv, stepContainer); // 为子步骤添加添加和删除按钮
                    addRemoveButton(newStepDiv, stepContainer); // 调整为传递父容器
                    addAddSubStepButton(newStepDiv);

                    toinsert.push(newStepDiv)

                    // addIconsAndHint(newStepDiv, subStep.hint);
                    // addSplitButton(newStepDiv, stepContainer); // 为子步骤添加添加和删除按钮
                    // addRemoveButton(newStepDiv, stepContainer); // 调整为传递父容器
                    // addAddSubStepButton(newStepDiv);
                    // stepContainer.appendChild(newStepDiv);
                    

                });


                for (var i=toinsert.length-1; i>=0; i--){
                    stepContainer.insertBefore(toinsert[i], stepDiv.nextSibling)
                }

                stepContainer.removeChild(stepDiv);
                renumberSteps(stepContainer);
                adjustBlockHeights(stepContainer);


                var user_current_stepsData_withid = saveToJson_withid();

                console.log('更新之前')
                console.log(user_history_stepsData[user_history_stepsData.length - 1])
                console.log('更新之后')
                console.log(user_current_stepsData_withid);

                user_history_stepsData.push(user_current_stepsData_withid);

            }

            // 如果只包含一个内容，说明不是合并起来的，继续看是否有子步骤。如果没有子步骤，就展示出来，如果有子步骤，展示最后一个

            if (Object.keys(step_json).length == 1){
                step = step_json[Object.keys(step_json)[0]]

                console.log(step)

                if (!step.subSteps || Object.keys(step.subSteps).length === 0) {

                    console.log(step.correctStep)
                    // 同时设置class为蓝色info色
                    stepDiv.className = `step systemgiven`;

                    // 没有子步骤，直接设置textDiv.textContent为step的correctStep
                    // 获取第一个匹配的元素
                    var textContentElement = document.querySelector('.text-content');

                    console.log(textContentElement)


                    textContentElement.textContent = step.correctStep;



                    var user_current_stepsData_withid = saveToJson_withid();

                    console.log('更新之前')
                    console.log(user_history_stepsData[user_history_stepsData.length - 1])
                    console.log('更新之后')
                    console.log(user_current_stepsData_withid);

                    user_history_stepsData.push(user_current_stepsData_withid);


                } else {
                    // 有子步骤，创建所有subStepDiv，只有最后一个subStep有内容

                    // 有时候已经有了substeps-container了，就不需要再创建一个了。
                    if (stepDiv.querySelector('.substeps-container')) {
                        // console.log('stepDiv 包含类为 "substeps-container" 的子元素');

                        stepDiv.querySelector('.text-content').innerText = step.correctStep;

                        // var subStepsContainer = stepDiv.querySelector('.substeps-container');
                    } else {



                        subStepsContainer = document.createElement('div');
                        subStepsContainer.className = 'substeps-container';
                        stepDiv.appendChild(subStepsContainer); // 将子步骤容器添加到主步骤下方

                        // 创建折叠/展开图标
                        var toggleIcon = document.createElement('span');
                        toggleIcon.className = 'toggle-icon';
                        toggleIcon.innerHTML = '&#9654;'; // 展开图标符号
                        stepDiv.insertBefore(toggleIcon, subStepsContainer);

                        // 折叠/展开功能
                        toggleIcon.addEventListener('click', function() {
                            if (subStepsContainer.style.display === 'none') {
                                subStepsContainer.style.display = 'flex';
                                toggleIcon.innerHTML = '&#9660;'; // 折叠图标符号
                            } else {
                                subStepsContainer.style.display = 'none';
                                toggleIcon.innerHTML = '&#9654;'; // 展开图标符号
                            }
                        });
        

                        console.log(step)
                        Object.entries(step.subSteps).forEach(([subStepId, subStep], index, array) => {
                            var subStepDiv = document.createElement('div');
                            subStepDiv.id = subStep.id;
                            // 同时设置class为蓝色info色
                            subStepDiv.className = `substep missing`;
                            subStepDiv.style.flexDirection = 'column'; // 确保内容和子步骤垂直排列

                            console.log(index)
                            console.log(array.length - 1)
                            
                            console.log(subStep)
                            console.log(subStep.correctStep)
                            subStepDiv.innerHTML = `
                                    <textarea class='text-content' placeholder='Input Your Thoughts'>${index === array.length - 1 ? subStep.correctStep : ''}</textarea>
                                `;
                            
                            




                            if (index === array.length - 1){
                                subStepDiv.className = `substep systemgiven`;
                            }
                            addIconsAndHint(subStepDiv, subStep.hint);
                            addSplitButton_substep(subStepDiv, subStepsContainer); // 为子步骤添加添加和删除按钮
                            addRemoveButton_substep(subStepDiv, subStepsContainer); // 调整为传递父容器
                            addAddSubStepButton(subStepDiv);
                            subStepsContainer.appendChild(subStepDiv);
                            renumberSteps(subStepsContainer);


                            var user_current_stepsData_withid = saveToJson_withid();

                            console.log('更新之前')
                            console.log(user_history_stepsData[user_history_stepsData.length - 1])
                            console.log('更新之后')
                            console.log(user_current_stepsData_withid);

                            user_history_stepsData.push(user_current_stepsData_withid);

                        });


                        // 计算和设置子步骤高度
                        adjustSubStepHeights(subStepsContainer);
                    }

                }

            
            }


            hiddenbydefault();



        }






        function renumberSteps(container) {
            Array.from(container.children).forEach((child, index) => {
                // 查找或创建编号元素
                let stepNumberDiv = child.querySelector('.step-number');
                if (!stepNumberDiv) {
                    stepNumberDiv = document.createElement('div');
                    stepNumberDiv.className = 'step-number';
                    stepNumberDiv.style.position = 'absolute';
                    stepNumberDiv.style.top = '5px';
                    stepNumberDiv.style.right = '5px';
                    stepNumberDiv.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
                    stepNumberDiv.style.color = 'white';
                    stepNumberDiv.style.padding = '2px 5px';
                    stepNumberDiv.style.borderRadius = '3px';
                    stepNumberDiv.style.fontSize = '12px';
                    child.appendChild(stepNumberDiv);
                }
                stepNumberDiv.textContent = `${index + 1}`;
            });
        }














function validateSteps_firstfromeditor(steps, path = []) {
    let isValid = true;

    // 检查是否包含 "steps" 键
    if (!("steps" in steps)) {

        console.log('进入了这里了')
        return false;
    }


    var steps = steps["steps"];

    for (let key in steps) {
        const step = steps[key];
        const stepPath = path.concat(key);

        console.log(`Validating step at path: ${stepPath.join(' -> ')}`);

        const hasCorrectStep = 'correctStep' in step;
        const hasStatusCorrectness = 'status' in step && 'correctness' in step.status;
        const hasStatusCanBeDivided = 'status' in step && 'can be further divided' in step.status;

        console.log(`  hasCorrectStep: ${hasCorrectStep}`);
        console.log(`  hasStatusCorrectness: ${hasStatusCorrectness}`);
        console.log(`  hasStatusCanBeDivided: ${hasStatusCanBeDivided}`);

        if (!hasCorrectStep || !hasStatusCorrectness || !hasStatusCanBeDivided) {

            console.log("难道是这里错了？")
            isValid = false;
        }

        // 递归验证子步骤，如果存在 "subSteps" 键
        if ('subSteps' in step) {
            const subStepValid = validateSteps_firstfromeditor({ "steps": step.subSteps }, stepPath);
            if (!subStepValid) isValid = false;
        }
    }

    console.log(isValid)
    return isValid;
}




function validateSteps_fromBlock(steps, path = []) {
    let isValid = true;

    // 检查是否包含 "steps" 键
    if (!("steps" in steps)) {
        return false;
    }


    var steps = steps["steps"];


    for (let key in steps) {
        const step = steps[key];
        const stepPath = path.concat(key);

        console.log(`Validating step at path: ${stepPath.join(' -> ')}`);

        const hasCorrectStep = 'correctStep' in step;
        const hasStudentInput = 'student current input' in step;
        const hasStatusCorrectness = 'status' in step && 'correctness' in step.status;
        const hasStatusCanBeDivided = 'status' in step && 'can be further divided' in step.status;

        console.log(`  hasCorrectStep: ${hasCorrectStep}`);
        console.log(`  hasStudentInput: ${hasStudentInput}`);
        console.log(`  hasStatusCorrectness: ${hasStatusCorrectness}`);
        console.log(`  hasStatusCanBeDivided: ${hasStatusCanBeDivided}`);

        if (!hasCorrectStep || !hasStudentInput || !hasStatusCorrectness || !hasStatusCanBeDivided) {
            isValid = false;
        }

        // 递归验证子步骤，如果存在 "subSteps" 键
        if ('subSteps' in step) {
            const subStepValid = validateSteps_fromBlock({ "steps": step.subSteps }, stepPath);
            if (!subStepValid) isValid = false;
        }
    }

    return isValid;
}


function validateSteps_copyback(steps, path = []) {
    let isValid = true;


    for (let key in steps) {
        const step = steps[key];
        const stepPath = path.concat(key);

        console.log(`Validating step at path: ${stepPath.join(' -> ')}`);

        const hasCorrectStep = 'correctStep' in step;
        const hasContent = 'content' in step;
        const hasLineNumber = 'lineNumber' in step;

        console.log(`  hasContent: ${hasContent}`);
        console.log(`  hasLineNumber: ${hasLineNumber}`);

        if (!hasContent || !hasLineNumber) {
            isValid = false;
        }

        // 递归验证子步骤，如果存在 "subSteps" 键
        if ('substeps' in step) {
            const subStepValid = validateSteps_copyback(step.substeps);
            if (!subStepValid) isValid = false;
        }
    }

    return isValid;
}



function validateSteps_checkmapping(steps, path = []) {
    let isValid = true;




    const hasUnmappedCode = 'code lines that do not have corresponding step or substep' in steps;
    const hasUnmappedStep = 'step or substeps that do not have corresponding code' in steps;

    console.log(`  hasUnmappedCode: ${hasUnmappedCode}`);
    console.log(`  hasUnmappedStep: ${hasUnmappedStep}`);

    if (!hasUnmappedCode || !hasUnmappedStep) {
        isValid = false;
    }



    return isValid;
}











































        // 假设 problem_json 变量包含你的 JSON 数据
        const problem_json = {

            "1": {
                "title": "Roman to Integer",
                "problem": `Roman numerals are represented by seven different symbols: I, V, X, L, C, D and M.

Symbol       Value
I             1
V             5
X             10
L             50
C             100
D             500
M             1000

For example, 2 is written as II in Roman numeral, just two ones added together. 12 is written as XII, which is simply X + II. The number 27 is written as XXVII, which is XX + V + II.

Roman numerals are usually written largest to smallest from left to right. However, the numeral for four is not IIII. Instead, the number four is written as IV. Because the one is before the five we subtract it making four. The same principle applies to the number nine, which is written as IX. There are six instances where subtraction is used:

    I can be placed before V (5) and X (10) to make 4 and 9. 
    X can be placed before L (50) and C (100) to make 40 and 90. 
    C can be placed before D (500) and M (1000) to make 400 and 900.

Given a roman numeral, convert it to an integer.

 

Example 1:

Input: s = "III"
Output: 3
Explanation: III = 3.

Example 2:

Input: s = "LVIII"
Output: 58
Explanation: L = 50, V= 5, III = 3.

Example 3:

Input: s = "MCMXCIV"
Output: 1994
Explanation: M = 1000, CM = 900, XC = 90 and IV = 4.`,
                "code": 
`def romanToInt(s):
    """
    :type s: str
    :rtype: int
    """`,
    "correctCode":
`def romanToInt(s):
    """
    :type s: str
    :rtype: int
    """
    values = {
        "I": 1,
        "V": 5,
        "X": 10,
        "L": 50,
        "C": 100,
        "D": 500,
        "M": 1000,
    }
    total = 0
    i = 0
    while i < len(s):
        # If this is the subtractive case.
        if i + 1 < len(s) and values[s[i]] < values[s[i + 1]]:
            total += values[s[i + 1]] - values[s[i]]
            i += 2
        # Else this is NOT the subtractive case.
        else:
            total += values[s[i]]
            i += 1
    return total`,
                "func_header": "romanToInt",
                "testCases":  [
            {input: "III", targetOutput: "3"},
            {input: "LVIII", targetOutput: "58"},
            {input: "MCMXCIV", targetOutput: "1994"},
            ]
            },




            "2": {
                "title": "Search Insert Position",
                "problem": `Given a sorted array of distinct integers and a target value, return the index if the target is found. If not, return the index where it would be if it were inserted in order.

You must write an algorithm with O(log n) runtime complexity.

 

Example 1:

Input: nums = [1,3,5,6], target = 5
Output: 2

Example 2:

Input: nums = [1,3,5,6], target = 2
Output: 1

Example 3:

Input: nums = [1,3,5,6], target = 7
Output: 4`,
                "code": 
`def searchInsert(nums, target):
    """
    :type nums: List[int]
    :type target: int
    :rtype: int
    """`,
    "correctCode":
`def searchInsert(nums, target):
    """
    :type nums: List[int]
    :type target: int
    :rtype: int
    """
    left, right = 0, len(nums) - 1
    while left <= right:
        pivot = (left + right) // 2
        if nums[pivot] == target:
            return pivot
        if target < nums[pivot]:
            right = pivot - 1
        else:
            left = pivot + 1
    return left`,
                "func_header": "searchInsert",
                "testCases":  [
            {input: "nums = [1,3,5,6], target = 5", targetOutput: "2"},
            {input: "nums = [1,3,5,6], target = 2", targetOutput: "1"},
            {input: "nums = [1,3,5,6], target = 7", targetOutput: "4"},
            ]
            },










            "3": {
                "title": "Plus One",
                "problem": `You are given a large integer represented as an integer array digits, where each digits[i] is the ith digit of the integer. The digits are ordered from most significant to least significant in left-to-right order. The large integer does not contain any leading 0's.

Increment the large integer by one and return the resulting array of digits.

 

Example 1:

Input: digits = [1,2,3]
Output: [1,2,4]
Explanation: The array represents the integer 123.
Incrementing by one gives 123 + 1 = 124.
Thus, the result should be [1,2,4].

Example 2:

Input: digits = [4,3,2,1]
Output: [4,3,2,2]
Explanation: The array represents the integer 4321.
Incrementing by one gives 4321 + 1 = 4322.
Thus, the result should be [4,3,2,2].

Example 3:

Input: digits = [9]
Output: [1,0]
Explanation: The array represents the integer 9.
Incrementing by one gives 9 + 1 = 10.
Thus, the result should be [1,0].`,
                "code": 
`def plusOne(digits):`,
    "correctCode":
`def plusOne(digits):
    n = len(digits)

    # move along the input array starting from the end
    for i in range(n):
        idx = n - 1 - i

        # Set all the nines at the end of the array to zeros
        if digits[idx] == 9:
            digits[idx] = 0

        # Here we have the rightmost not-nine
        else:
            # Increase this rightmost not-nine by 1
            digits[idx] += 1

            # and the job is done
            return digits

    # We're here because all the digits are nines
    return [1] + digits`,
                "func_header": "plusOne",
                "testCases": [
            {input: "[1,2,3]", targetOutput: "[1, 2, 4]"},
            {input: "[4,3,2,1]", targetOutput: "[4, 3, 2, 2]"},
            {input: "[9]", targetOutput: "[1, 0]"},
            ]
            },












            "4": {
                "title": "Climbing Stairs",
                "problem": `You are climbing a staircase. It takes n steps to reach the top.

Each time you can either climb 1 or 2 steps. In how many distinct ways can you climb to the top?

 

Example 1:

Input: n = 2
Output: 2
Explanation: There are two ways to climb to the top.
1. 1 step + 1 step
2. 2 steps

Example 2:

Input: n = 3
Output: 3
Explanation: There are three ways to climb to the top.
1. 1 step + 1 step + 1 step
2. 1 step + 2 steps
3. 2 steps + 1 step`,
                "code": 
`def climbStairs(n):
    """
    :type n: int
    :rtype: int
    """`,
    "correctCode":
`def climbStairs(n):
    """
    :type n: int
    :rtype: int
    """
    if n == 1:
        return 1
    dp = [0 for _ in range(n + 1)]
    dp[1] = 1
    dp[2] = 2
    for i in range(3, n + 1):
        dp[i] = dp[i - 1] + dp[i - 2]
    return dp[n]`,
    "func_header": "climbStairs",
    "testCases": [
            {input: "2", targetOutput: "2"},
            {input: "3", targetOutput: "3"},
            {input: "4", targetOutput: "5"},
            ]
            },











            "5": {
                "title": "Best Time to Buy and Sell Stock",
                "problem": `You are given an array prices where prices[i] is the price of a given stock on the ith day.

You want to maximize your profit by choosing a single day to buy one stock and choosing a different day in the future to sell that stock.

Return the maximum profit you can achieve from this transaction. If you cannot achieve any profit, return 0.

 

Example 1:

Input: prices = [7,1,5,3,6,4]
Output: 5
Explanation: Buy on day 2 (price = 1) and sell on day 5 (price = 6), profit = 6-1 = 5.
Note that buying on day 2 and selling on day 1 is not allowed because you must buy before you sell.

Example 2:

Input: prices = [7,6,4,3,1]
Output: 0
Explanation: In this case, no transactions are done and the max profit = 0.`,
                "code": 
`def maxProfit(prices):
    """
    :type prices: List[int]
    :rtype: int
    """`,
    "correctCode":
`def maxProfit(prices):
    """
    :type prices: List[int]
    :rtype: int
    """
    max_profit = 0
    for i in range(len(prices) - 1):
        for j in range(i + 1, len(prices)):
            profit = prices[j] - prices[i]
            if profit > max_profit:
                max_profit = profit

    return max_profit`,
                "func_header": "maxProfit",
                "testCases": [
            {input: "[7,1,5,3,6,4]", targetOutput: "5"},
            {input: "[7,6,4,3,1]", targetOutput: "0"}
            ]
            },


            "6": {
                "title": "Counting Bits",
                "problem": `Given an integer n, return an array ans of length n + 1 such that for each i (0 <= i <= n), ans[i] is the number of 1's in the binary representation of i.

 

Example 1:

Input: n = 2
Output: [0,1,1]
Explanation:
0 --> 0
1 --> 1
2 --> 10

Example 2:

Input: n = 5
Output: [0,1,1,2,1,2]
Explanation:
0 --> 0
1 --> 1
2 --> 10
3 --> 11
4 --> 100
5 --> 101`,
                "code": 
`def countBits(n):
    """
    :type n: int
    :rtype: List[int]
    """`,
    "correctCode":
`def countBits(n):
    """
    :type n: int
    :rtype: List[int]
    """
    ans = [0] * (n + 1)
    for x in range(1, n + 1):
        # x // 2 is x >> 1 and x % 2 is x & 1
        ans[x] = ans[x >> 1] + (x & 1) 
    return ans `,
                "func_header": "countBits",
                "testCases": [
            {input: "2", targetOutput: "[0, 1, 1]"},
            {input: "5", targetOutput: "[0, 1, 1, 2, 1, 2]"}
            ]
            },


            "7": {
                "title": "Is Subsequence",
                "problem": `Given two strings s and t, return true if s is a subsequence of t, or false otherwise.

A subsequence of a string is a new string that is formed from the original string by deleting some (can be none) of the characters without disturbing the relative positions of the remaining characters. (i.e., "ace" is a subsequence of "abcde" while "aec" is not).

 

Example 1:

Input: s = "abc", t = "ahbgdc"
Output: true

Example 2:

Input: s = "axc", t = "ahbgdc"
Output: false`,
                "code": 
`def isSubsequence(s, t):
    """
    :type s: str
    :type t: str
    :rtype: bool
    """`,
    "correctCode":
`def isSubsequence(s, t):
    """
    :type s: str
    :type t: str
    :rtype: bool
    """
    source_len, target_len = len(s), len(t)

    # the source string is empty
    if source_len == 0:
        return True

    # matrix to store the history of matches/deletions
    dp = [ [0] * (target_len + 1) for _ in range(source_len + 1)]

    # DP compute, we fill the matrix column by column, bottom up
    for col in range(1, target_len + 1):
        for row in range(1, source_len + 1):
            if s[row - 1] == t[col - 1]:
                # find another match
                dp[row][col] = dp[row - 1][col - 1] + 1
            else:
                # retrieve the maximal result from previous prefixes
                dp[row][col] = max(dp[row][col - 1], dp[row - 1][col])

        # check if we can consume the entire source string,
        #   with the current prefix of the target string.
        if dp[source_len][col] == source_len:
            return True

    return False`,
                "func_header": "isSubsequence",
                "testCases": [
            {input: "s = abc, t = ahbgdc", targetOutput: "true"},
            {input: "s = axc, t = ahbgdc", targetOutput: "false"}
            ]
            },


            "8": {
                "title": "Largest Divisible Subset",
                "problem": `Given a set of distinct positive integers nums, return the largest subset answer such that every pair (answer[i], answer[j]) of elements in this subset satisfies:

answer[i] % answer[j] == 0, or
answer[j] % answer[i] == 0

If there are multiple solutions, return any of them.



Example 1:

Input: nums = [1,2,3]
Output: [1,2]
Explanation: [1,3] is also accepted.

Example 2:

Input: nums = [1,2,4,8]
Output: [1,2,4,8]`,
                "code": 
`def largestDivisibleSubset(nums):
    """
    :type nums: List[int]
    :rtype: List[int]
    """`,
    "correctCode":
`def largestDivisibleSubset(nums):
    """
    :type nums: List[int]
    :rtype: List[int]
    """
    # The container that holds all intermediate solutions.
    # key: the largest element in a valid subset.
    subsets = {-1: set()}
    
    for num in sorted(nums):
        subsets[num] = max([subsets[k] for k in subsets if num % k == 0], key=len) | {num}
    
    return list(max(subsets.values(), key=len))`,
                "func_header": "largestDivisibleSubset",
                "testCases": [
            {input: "[1,2,3]", targetOutput: "[1, 2]"},
            {input: "[1,2,4,8]", targetOutput: "[1, 2, 4, 8]"}
            ]
            },


            "9": {
                "title": "Majority Element",
                "problem": `Given an array nums of size n, return the majority element.

The majority element is the element that appears more than ⌊n / 2⌋ times. You may assume that the majority element always exists in the array.

 

Example 1:

Input: nums = [3,2,3]
Output: 3

Example 2:

Input: nums = [2,2,1,1,1,2,2]
Output: 2`,
                "code": 
`def majorityElement(nums):
    """
    :type nums: List[int]
    :rtype: int
    """`,
    "correctCode":
`def majorityElement(nums):
    """
    :type nums: List[int]
    :rtype: int
    """
    majority_count = len(nums) // 2
    for num in nums:
        count = sum(1 for elem in nums if elem == num)
        if count > majority_count:
            return num`,
                "func_header": "majorityElement",
                "testCases": [
            {input: "[3,2,3]", targetOutput: "3"},
            {input: "[2,2,1,1,1,2,2]", targetOutput: "2"}
            ]
            }
        };

        document.getElementById('show-problem-list').addEventListener('click', function() {
            var problemListContainer = document.getElementById('problem-list-container');
            if (problemListContainer.classList.contains('show')) {
                problemListContainer.classList.remove('show');
            } else {
                problemListContainer.classList.add('show');
                populateProblemList();
            }
        });

        function populateProblemList() {
            var problemList = document.getElementById('problem-list');
            problemList.innerHTML = '';
            for (var key in problem_json) {
                if (problem_json.hasOwnProperty(key)) {
                    var li = document.createElement('li');
                    li.textContent = problem_json[key].title;

                    // 使用立即执行函数表达式（IIFE）捕获当前的 key 值
                    (function(currentKey) {
                        li.addEventListener('click', function() {

                            // Remove selected class from all items
                            var items = problemList.getElementsByTagName('li');
                            for (var i = 0; i < items.length; i++) {
                                items[i].classList.remove('selected');
                                console.log(items[i])
                            }
                            // Add selected class to the clicked item
                            console.log(this)
                            this.classList.add('selected');
                            console.log(this)



                            selectProblem(problem_json[currentKey]);
                        });
                    })(key);

                    problemList.appendChild(li);
                }
            }
        }

        function selectProblem(problem) {
            document.getElementById('problem-description').textContent = problem.problem;
            editor.setValue(problem.correctCode);
            document.getElementById('problem-list-container').classList.remove('show');
            testCases = problem.testCases;
            console.log(testCases);

            function_header = problem.func_header;


            document.getElementById("question_name").innerText = 'Question: ' + problem.title;


            // 先清空
            for (let i = 0; i < 3; i++) {
                document.getElementById(`input-${i + 1}`).innerText = '';
                document.getElementById(`target-output-${i + 1}`).innerText = '';
                document.getElementById(`your-output-${i + 1}`).innerText = '';


                const correctnessElement = document.getElementById(`correctness-${i + 1}`);
                correctnessElement.innerText = '';
                correctnessElement.className = '';

                document.getElementById('output').className = '';
                document.getElementById('output').textContent = '';
            }




            for (let i = 0; i < testCases.length; i++) {
                const input = testCases[i].input;
                const targetOutput = testCases[i].targetOutput;


                document.getElementById(`input-${i + 1}`).innerText = input;
                document.getElementById(`target-output-${i + 1}`).innerText = targetOutput;
            }
        }


        document.addEventListener('click', function(event) {
            var problemListContainer = document.getElementById('problem-list-container');
            if (!problemListContainer.contains(event.target) && !document.getElementById('show-problem-list').contains(event.target)) {
                problemListContainer.classList.remove('show');
            }
        });

        document.getElementById('problem-list-container').addEventListener('click', function(event) {
            event.stopPropagation();
        });







    </script>
</body>
</html>
